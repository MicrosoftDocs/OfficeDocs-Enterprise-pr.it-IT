---
title: Implementazione di ExpressRoute per Office 365
ms.author: kvice
author: kelleyvice-msft
manager: laurawi
ms.date: 12/5/2017
audience: ITPro
ms.topic: conceptual
ms.service: o365-administration
localization_priority: Normal
ms.collection: Ent_O365
ms.custom: Adm_O365
search.appverid:
- MET150
- MOE150
- BCS160
ms.assetid: 77735c9d-8b80-4d2f-890e-a8598547dea6
description: ExpressRoute per Office 365 fornisce un percorso di routing alternativo a numerosi servizi Internet di Office 365. L'architettura di ExpressRoute per Office 365 si basa sulla pubblicità di prefissi IP pubblici dei servizi di Office 365 già accessibili tramite Internet nei circuiti ExpressRoute di provisioning per la successiva ridistribuzione di tali prefissi IP in rete. Con ExpressRoute è possibile abilitare efficacemente diversi percorsi di routing, tramite Internet e tramite ExpressRoute, per molti servizi di Office 365. Questo stato del routing sulla rete può rappresentare una modifica significativa del modo in cui è stata progettata la topologia di rete interna.
ms.openlocfilehash: 3e3171c3058b485ef644af3f1d33a9f80c71345c
ms.sourcegitcommit: 0449c6f854c682719cac1bd0d086f2e3b20078b9
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/05/2019
ms.locfileid: "34722725"
---
# <a name="implementing-expressroute-for-office-365"></a><span data-ttu-id="014e8-106">Implementazione di ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-106">Implementing ExpressRoute for Office 365</span></span>

<span data-ttu-id="014e8-107">ExpressRoute per Office 365 fornisce un percorso di routing alternativo a numerosi servizi Internet di Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-107">ExpressRoute for Office 365 provides an alternate routing path to many internet facing Office 365 services.</span></span> <span data-ttu-id="014e8-108">L'architettura di ExpressRoute per Office 365 si basa sulla pubblicità di prefissi IP pubblici dei servizi di Office 365 già accessibili tramite Internet nei circuiti ExpressRoute di provisioning per la successiva ridistribuzione di tali prefissi IP in rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-108">The architecture of ExpressRoute for Office 365 is based on advertising public IP prefixes of Office 365 services that are already accessible over the Internet into your provisioned ExpressRoute circuits for subsequent redistribution of those IP prefixes into your network.</span></span> <span data-ttu-id="014e8-109">Con ExpressRoute è possibile abilitare efficacemente diversi percorsi di routing, tramite Internet e tramite ExpressRoute, per molti servizi di Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-109">With ExpressRoute you effectively enable several different routing paths, through the internet and through ExpressRoute, for many Office 365 services.</span></span> <span data-ttu-id="014e8-110">Questo stato del routing sulla rete può rappresentare una modifica significativa del modo in cui è stata progettata la topologia di rete interna.</span><span class="sxs-lookup"><span data-stu-id="014e8-110">This state of routing on your network may represent a significant change to how your internal network topology is designed.</span></span>
  
 <span data-ttu-id="014e8-111">**Stato:** Guida completa V2</span><span class="sxs-lookup"><span data-stu-id="014e8-111">**Status:** Complete Guide v2</span></span>
  
<span data-ttu-id="014e8-112">È necessario pianificare attentamente l'implementazione di ExpressRoute per Office 365 per soddisfare la complessità della rete di routing disponibile tramite un circuito dedicato con route iniettate nella rete di base e in Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-112">You must carefully plan your ExpressRoute for Office 365 implementation to accommodate for the network complexities of having routing available via both a dedicated circuit with routes injected into your core network and the internet.</span></span> <span data-ttu-id="014e8-113">Se l'utente e il team non eseguono la pianificazione e il testing dettagliato in questa guida, è possibile che si verifichi un rischio intermittente o una perdita totale di connettività per i servizi di Office 365 quando è abilitato il circuito ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-113">If you and your team don't perform the detailed planning and testing in this guide, there is a high risk you'll experience intermittent or a total loss of connectivity to Office 365 services when the ExpressRoute circuit is enabled.</span></span>
  
<span data-ttu-id="014e8-114">Per eseguire correttamente l'implementazione, è necessario analizzare i requisiti dell'infrastruttura, esaminare dettagliatamente la valutazione e la progettazione della rete, pianificare attentamente la distribuzione in modalità a fasi e controllate e creare un piano dettagliato di verifica e convalida.</span><span class="sxs-lookup"><span data-stu-id="014e8-114">To have a successful implementation, you will need to analyze your infrastructure requirements, go through detailed network assessment and design, carefully plan the rollout in a staged and controlled manner, and build a detailed validation and testing plan.</span></span> <span data-ttu-id="014e8-115">Per un ambiente esteso e distribuito, non è raro vedere le implementazioni che si estendono per diversi mesi.</span><span class="sxs-lookup"><span data-stu-id="014e8-115">For a large, distributed environment it's not uncommon to see implementations span several months.</span></span> <span data-ttu-id="014e8-116">Questa guida è stata progettata per facilitare la pianificazione in anticipo.</span><span class="sxs-lookup"><span data-stu-id="014e8-116">This guide is designed to help you plan ahead.</span></span>
  
<span data-ttu-id="014e8-117">Le grandi distribuzioni con esito positivo possono richiedere sei mesi di pianificazione e includere spesso i membri del team di molte aree dell'organizzazione, inclusi gli amministratori di reti, firewall e server proxy, gli amministratori di Office 365, la sicurezza, il supporto per gli utenti finali, il progetto gestione e sponsorizzazione esecutiva.</span><span class="sxs-lookup"><span data-stu-id="014e8-117">Large successful deployments may take six months in planning and often include team members from many areas in the organization including networking, Firewall and Proxy server administrators, Office 365 administrators, security, end-user support, project management, and executive sponsorship.</span></span> <span data-ttu-id="014e8-118">Gli investimenti nel processo di pianificazione riducono la probabilità che si verifichino errori di distribuzione che causano tempi di inattività o una risoluzione dei problemi complessa e costosa.</span><span class="sxs-lookup"><span data-stu-id="014e8-118">Your investment in the planning process will reduce the likelihood that you'll experience deployment failures resulting in downtime or complex and expensive troubleshooting.</span></span>
  
<span data-ttu-id="014e8-119">Prima di avviare questa guida all'implementazione, è prevedibile che i prerequisiti seguenti siano stati completati.</span><span class="sxs-lookup"><span data-stu-id="014e8-119">We expect the following pre-requisites to be completed before this implementation guide is started.</span></span>
  
1. <span data-ttu-id="014e8-120">È stata completata una valutazione della rete per determinare se ExpressRoute è consigliato e approvato.</span><span class="sxs-lookup"><span data-stu-id="014e8-120">You've completed a network assessment to determine if ExpressRoute is recommended and approved.</span></span>

2. <span data-ttu-id="014e8-121">È stato selezionato un provider di servizi di rete di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-121">You've selected an ExpressRoute network service provider.</span></span> <span data-ttu-id="014e8-122">Sono disponibili informazioni dettagliate sui [partner di ExpressRoute e sulle posizioni](https://azure.microsoft.com/documentation/articles/expressroute-locations/)di peering.</span><span class="sxs-lookup"><span data-stu-id="014e8-122">Find details about the [ExpressRoute partners and peering locations](https://azure.microsoft.com/documentation/articles/expressroute-locations/).</span></span>

3. <span data-ttu-id="014e8-123">Sono già state lette e interpretate la [documentazione di ExpressRoute](https://azure.microsoft.com/documentation/services/expressroute/) e la rete interna è in grado di rispettare i prerequisiti ExpressRoute end to end.</span><span class="sxs-lookup"><span data-stu-id="014e8-123">You've already read and understand the [ExpressRoute documentation](https://azure.microsoft.com/documentation/services/expressroute/) and your internal network is able to meet ExpressRoute pre-requisites end to end.</span></span>

4. <span data-ttu-id="014e8-124">Il team ha letto tutte le linee guida e la documentazione pubblica [https://aka.ms/expressrouteoffice365](https://aka.ms/expressrouteoffice365)di [https://aka.ms/ert](https://aka.ms/ert), e ha guardato la serie di [formazione di Azure ExpressRoute per Office 365](https://channel9.msdn.com/series/aer) sul canale 9 per acquisire una conoscenza dei dettagli tecnici critici, tra cui:</span><span class="sxs-lookup"><span data-stu-id="014e8-124">Your team has read all of the public guidance and documentation at [https://aka.ms/expressrouteoffice365](https://aka.ms/expressrouteoffice365), [https://aka.ms/ert](https://aka.ms/ert), and watched the [Azure ExpressRoute for Office 365 Training](https://channel9.msdn.com/series/aer) series on Channel 9 to gain an understanding of critical technical details including:</span></span>

      - <span data-ttu-id="014e8-125">Dipendenze Internet dei servizi SaaS.</span><span class="sxs-lookup"><span data-stu-id="014e8-125">The internet dependencies of SaaS services.</span></span>

      - <span data-ttu-id="014e8-126">Come evitare rotte asimmetriche e gestire il routing complesso.</span><span class="sxs-lookup"><span data-stu-id="014e8-126">How to avoid asymmetric routes and handle complex routing.</span></span>

      - <span data-ttu-id="014e8-127">Informazioni su come incorporare i controlli a livello di sicurezza, disponibilità e applicazione del perimetro.</span><span class="sxs-lookup"><span data-stu-id="014e8-127">How to incorporate perimeter security, availability, and application level controls.</span></span>

## <a name="begin-by-gathering-requirements"></a><span data-ttu-id="014e8-128">Iniziare con la raccolta dei requisiti</span><span class="sxs-lookup"><span data-stu-id="014e8-128">Begin by gathering requirements</span></span>
<span data-ttu-id="014e8-129"><a name="requirements"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-129"></span></span>

<span data-ttu-id="014e8-130">Iniziare determinando le funzionalità e i servizi che si intende adottare all'interno dell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="014e8-130">Start by determining which features and services you plan to adopt within your organization.</span></span> <span data-ttu-id="014e8-131">È necessario determinare quali funzionalità dei diversi servizi di Office 365 verranno utilizzate e quali posizioni della rete ospiteranno gli utenti che utilizzano tali funzionalità.</span><span class="sxs-lookup"><span data-stu-id="014e8-131">You need to determine which features of the different Office 365 services will be used and which locations on your network will host people using those features.</span></span> <span data-ttu-id="014e8-132">Con il catalogo degli scenari, è necessario aggiungere gli attributi di rete necessari per ognuno di questi scenari. ad esempio flussi di traffico di rete in ingresso e in uscita e se gli endpoint di Office 365 sono disponibili su ExpressRoute oppure no.</span><span class="sxs-lookup"><span data-stu-id="014e8-132">With the catalog of scenarios, you need to add the network attributes that each of those scenarios require; such as inbound and outbound network traffic flows and if the Office 365 endpoints are available over ExpressRoute or not.</span></span>
  
<span data-ttu-id="014e8-133">Per raccogliere i requisiti dell'organizzazione:</span><span class="sxs-lookup"><span data-stu-id="014e8-133">To gather your organization's requirements:</span></span>
  
- <span data-ttu-id="014e8-134">Catalogare il traffico di rete in ingresso e in uscita per i servizi di Office 365 che l'organizzazione sta utilizzando.</span><span class="sxs-lookup"><span data-stu-id="014e8-134">Catalog the inbound and outbound network traffic for the Office 365 services your organization is using.</span></span> <span data-ttu-id="014e8-135">Consultare la pagina degli URL e degli intervalli di indirizzi IP di Office 365 per la descrizione dei flussi necessari per diversi scenari di Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-135">Consult Office 365 URLs and IP address ranges page for the description of flows that different Office 365 scenarios require.</span></span>

- <span data-ttu-id="014e8-136">Raccogliere la documentazione relativa alla topologia di rete esistente che mostra i dettagli relativi alla backbone e alla topologia WAN interna, alla connettività dei siti satellite, alla connettività degli utenti di Mile, al routing ai punti di uscita perimetrali di rete e ai servizi proxy.</span><span class="sxs-lookup"><span data-stu-id="014e8-136">Gather documentation of existing network topology showing details of your internal WAN backbone and topology, connectivity of satellite sites, last mile user connectivity, routing to network perimeter egress points, and proxy services.</span></span>

  - <span data-ttu-id="014e8-137">Identificare gli endpoint dei servizi in ingresso nei diagrammi di rete a cui si connetterà Office 365 e altri servizi Microsoft, mostrando sia Internet che i percorsi di connessione di ExpressRoute proposti.</span><span class="sxs-lookup"><span data-stu-id="014e8-137">Identify inbound service endpoints on the network diagrams that Office 365 and other Microsoft services will connect to, showing both internet and proposed ExpressRoute connection paths.</span></span>

  - <span data-ttu-id="014e8-138">Identificare tutte le posizioni degli utenti geografici e la connettività WAN tra i percorsi insieme a quali posizioni sono attualmente in uscita su Internet e quali posizioni vengono proposte per avere un'uscita per una posizione di peering di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-138">Identify all geographic user locations and WAN connectivity between locations along with which locations currently have an egress to the internet and which locations are proposed to have an egress to an ExpressRoute peering location.</span></span>

  - <span data-ttu-id="014e8-139">Identificare tutti i dispositivi perimetrali, ad esempio proxy, firewall e così via, e catalogare la relazione con i flussi in corso su Internet e ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-139">Identify all edge devices, such as proxies, firewalls, and so on and catalog their relationship to flows going over the Internet and ExpressRoute.</span></span>

  - <span data-ttu-id="014e8-140">Documentare se gli utenti finali avranno accesso ai servizi di Office 365 tramite routing diretto o proxy di applicazione indiretta per flussi Internet e ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-140">Document whether end users will access Office 365 services via direct routing or indirect application proxy for both Internet and ExpressRoute flows.</span></span>

- <span data-ttu-id="014e8-141">Aggiungere il percorso del tenant e dei percorsi Meet-me al diagramma di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-141">Add the location of your tenant and meet-me locations to your network diagram.</span></span>

- <span data-ttu-id="014e8-142">Stimare le caratteristiche di latenza e prestazioni di rete attese e osservate dalle principali posizioni degli utenti a Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-142">Estimate the expected and observed network performance and latency characteristics from major user locations to Office 365.</span></span> <span data-ttu-id="014e8-143">Tenere presente che Office 365 è un insieme di servizi globale e distribuito e che gli utenti si connettono a percorsi che possono essere diversi dalla posizione del tenant.</span><span class="sxs-lookup"><span data-stu-id="014e8-143">Keep in mind that Office 365 is a global and distributed set of services and users will be connecting to locations that may be different from the location of their tenant.</span></span> <span data-ttu-id="014e8-144">Per questo motivo, è consigliabile misurare e ottimizzare la latenza tra l'utente e il perimetro più vicino della rete globale Microsoft su ExpressRoute e sulle connessioni Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-144">For this reason, it is recommended to measure and optimize for latency between the user and the closest edge of Microsoft global network over ExpressRoute and Internet connections.</span></span> <span data-ttu-id="014e8-145">È possibile utilizzare i risultati della valutazione della rete per agevolare questa attività.</span><span class="sxs-lookup"><span data-stu-id="014e8-145">You can use your findings from the network assessment to aid with this task.</span></span>

- <span data-ttu-id="014e8-146">Elencare i requisiti di sicurezza della rete aziendale e di disponibilità elevata che devono essere soddisfatti con la nuova connessione di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-146">List company network security and high availability requirements that need to be met with the new ExpressRoute connection.</span></span> <span data-ttu-id="014e8-147">Ad esempio, in che modo gli utenti continuano ad accedere a Office 365 nel caso di un errore del circuito ExpressRoute o di uscita Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-147">For example, how do users continue to get access to Office 365 in the event of the Internet egress or ExpressRoute circuit failure.</span></span>

- <span data-ttu-id="014e8-148">Documentare quali flussi di rete di Office 365 in ingresso e in uscita utilizzerà il percorso Internet e che utilizzerà ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-148">Document which inbound and outbound Office 365 network flows will use the Internet path and which will use ExpressRoute.</span></span> <span data-ttu-id="014e8-149">Le specifiche delle posizioni geografiche degli utenti e i dettagli della topologia di rete locale possono richiedere che il piano sia diverso da un percorso utente a un altro.</span><span class="sxs-lookup"><span data-stu-id="014e8-149">The specifics of geographical locations of your users and details of your on-premises network topology may require the plan to be different from one user location to another.</span></span>

### <a name="catalog-your-outbound-and-inbound-network-traffic"></a><span data-ttu-id="014e8-150">Catalogare il traffico di rete in uscita e in ingresso</span><span class="sxs-lookup"><span data-stu-id="014e8-150">Catalog your outbound and inbound network traffic</span></span>
<span data-ttu-id="014e8-151"><a name="trafficCatalog"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-151"></span></span>

<span data-ttu-id="014e8-152">Per ridurre al minimo il routing e altre complessità di rete, si consiglia di utilizzare solo ExpressRoute per Office 365 per i flussi di traffico di rete necessari per eseguire una connessione dedicata a causa di requisiti normativi o come risultato della valutazione della rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-152">To minimize routing and other network complexities, we recommend that you only use ExpressRoute for Office 365 for the network traffic flows that are required to go over a dedicated connection due to regulatory requirements or as the result of the network assessment.</span></span> <span data-ttu-id="014e8-153">Inoltre, si consiglia di eseguire il routing di ExpressRoute e l'approccio in uscita e il traffico di rete in ingresso scorre come fasi diverse e distinte del progetto di implementazione.</span><span class="sxs-lookup"><span data-stu-id="014e8-153">Additionally, we recommend that you stage the scope of ExpressRoute routing and approach outbound and inbound network traffic flows as different and distinct stages of the implementation project.</span></span> <span data-ttu-id="014e8-154">Distribuire ExpressRoute per Office 365 solo per i flussi di traffico di rete in uscita avviati dall'utente e lasciare flussi di traffico di rete in ingresso su Internet può contribuire a controllare l'aumento della complessità topologica e dei rischi relativi all'introduzione di ulteriori asimmetrie possibilità di routing.</span><span class="sxs-lookup"><span data-stu-id="014e8-154">Deploy ExpressRoute for Office 365 for just user initiated outbound network traffic flows and leave inbound network traffic flows across the Internet can help to control the increase in topological complexity and risks of introducing additional asymmetric routing possibilities.</span></span>
  
<span data-ttu-id="014e8-155">Il catalogo del traffico di rete deve contenere liste di tutte le connessioni di rete in ingresso e in uscita che sono disponibili tra la rete locale e Microsoft.</span><span class="sxs-lookup"><span data-stu-id="014e8-155">Your network traffic catalog should contain listings of all the inbound and outbound network connections that you'll have between your on-premises network and Microsoft.</span></span>
  
- <span data-ttu-id="014e8-156">I flussi del traffico di rete in uscita sono scenari in cui viene avviata una connessione dall'ambiente locale, ad esempio da client o server interni, con una destinazione dei servizi Microsoft.</span><span class="sxs-lookup"><span data-stu-id="014e8-156">Outbound network traffic flows are any scenarios where a connection is initiated from your on-premises environment, such as from internal clients or servers, with a destination of the Microsoft services.</span></span> <span data-ttu-id="014e8-157">Queste connessioni possono essere dirette a Office 365 o indirettamente, ad esempio quando la connessione passa attraverso i server proxy, i firewall o altri dispositivi di rete nel percorso di Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-157">These connections may be direct to Office 365 or indirect, such as when the connection goes through proxy servers, firewalls, or other networking devices on the path to Office 365.</span></span>

- <span data-ttu-id="014e8-158">I flussi del traffico di rete in ingresso sono scenari in cui una connessione viene avviata dal cloud Microsoft a un host locale.</span><span class="sxs-lookup"><span data-stu-id="014e8-158">Inbound network traffic flows are any scenarios where a connection is initiated from the Microsoft cloud to an on-premises host.</span></span> <span data-ttu-id="014e8-159">In genere, queste connessioni devono passare attraverso il firewall e altre infrastrutture di sicurezza richieste dai criteri di sicurezza dei clienti per i flussi originati esternamente.</span><span class="sxs-lookup"><span data-stu-id="014e8-159">These connections typically need to go through firewall and other security infrastructure that customer security policy requires for externally originated flows.</span></span>

<span data-ttu-id="014e8-160">Leggere la sezione **garantire la simmetria del percorso** dell'articolo [routing con ExpressRoute per Office 365](https://support.office.com/article/Routing-with-ExpressRoute-for-Office-365-e1da26c6-2d39-4379-af6f-4da213218408) per determinare quali servizi invieranno il traffico in ingresso e cercare la colonna contrassegnata **come ExpressRoute per Office 365** in [Office 365 ](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2)articolo di riferimento per gli endpoint per determinare le altre informazioni di connettività.</span><span class="sxs-lookup"><span data-stu-id="014e8-160">Read the **Ensuring route symmetry** section of the article [Routing with ExpressRoute for Office 365](https://support.office.com/article/Routing-with-ExpressRoute-for-Office-365-e1da26c6-2d39-4379-af6f-4da213218408) to determine which services will send inbound traffic and look for the column marked **ExpressRoute for Office 365** in the [Office 365 endpoints](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2) reference article to determine the rest of the connectivity information.</span></span>
  
<span data-ttu-id="014e8-161">Per ogni servizio che richiede una connessione in uscita, è consigliabile descrivere la connettività pianificata per il servizio, tra cui il routing di rete, la configurazione del proxy, l'ispezione dei pacchetti e le esigenze di larghezza di banda.</span><span class="sxs-lookup"><span data-stu-id="014e8-161">For each service that requires an outbound connection, you'll want to describe the planned connectivity for the service including network routing, proxy configuration, packet inspection, and bandwidth needs.</span></span>
  
<span data-ttu-id="014e8-162">Per ogni servizio che richiede una connessione in ingresso, sono necessarie ulteriori informazioni.</span><span class="sxs-lookup"><span data-stu-id="014e8-162">For each service that requires an inbound connection, you'll need some additional information.</span></span> <span data-ttu-id="014e8-163">I server nel cloud Microsoft consentiranno di stabilire le connessioni alla rete locale.</span><span class="sxs-lookup"><span data-stu-id="014e8-163">Servers in the Microsoft cloud will establish connections to your on-premises network.</span></span> <span data-ttu-id="014e8-164">per garantire il corretto funzionamento delle connessioni, è necessario descrivere tutti gli aspetti di questa connettività, tra cui: le voci DNS pubbliche per i servizi che accetteranno queste connessioni in ingresso, gli indirizzi IP IPv4 in formato CIDR, quali apparecchiature ISP sono coinvolte e la modalità di gestione di NAT in ingresso o NAT di origine per queste connessioni.</span><span class="sxs-lookup"><span data-stu-id="014e8-164">to ensure the connections are made correctly, you'll want to describe all aspects of this connectivity, including; the public DNS entries for the services that will accept these inbound connections, the CIDR formatted IPv4 IP addresses, which ISP equipment is involved, and how inbound NAT or source NAT is handled for these connections.</span></span>
  
<span data-ttu-id="014e8-165">Le connessioni in ingresso devono essere esaminate indipendentemente dal fatto che si stiano connettendo su Internet o ExpressRoute per garantire che il routing asimmetrico non sia stato introdotto.</span><span class="sxs-lookup"><span data-stu-id="014e8-165">Inbound connections should be reviewed regardless of whether they're connecting over the internet or ExpressRoute to ensure asymmetric routing hasn't been introduced.</span></span> <span data-ttu-id="014e8-166">In alcuni casi, gli endpoint locali che i servizi di Office 365 avviano le connessioni in ingresso potrebbero dover essere accessibili anche da altri servizi Microsoft e non Microsoft.</span><span class="sxs-lookup"><span data-stu-id="014e8-166">In some cases, on-premises endpoints that Office 365 services initiate inbound connections to may also need to be accessed by other Microsoft and non-Microsoft services.</span></span> <span data-ttu-id="014e8-167">È fondamentale che l'abilitazione del routing di ExpressRoute a questi servizi per gli scopi di Office 365 non interrompa altri scenari.</span><span class="sxs-lookup"><span data-stu-id="014e8-167">It is paramount that enabling ExpressRoute routing to these services for Office 365 purposes doesn't break other scenarios.</span></span> <span data-ttu-id="014e8-168">In molti casi, i clienti potrebbero dover implementare specifiche modifiche alla propria rete interna, ad esempio NAT basata sull'origine, per garantire che i flussi in ingresso da Microsoft rimangano simmetrici dopo che è stato abilitato ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-168">In many cases, customers may need to implement specific changes to their internal network, such as source based NAT, to ensure that inbound flows from Microsoft remain symmetric after ExpressRoute is enabled.</span></span>
  
<span data-ttu-id="014e8-169">Di seguito è indicato un esempio del livello di dettaglio necessario.</span><span class="sxs-lookup"><span data-stu-id="014e8-169">Here's a sample of the level of detail required.</span></span> <span data-ttu-id="014e8-170">In questo caso, l'ibrido di Exchange si instraderà al sistema locale su ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-170">In this case Exchange Hybrid would route to the on-premises system over ExpressRoute.</span></span>

|<span data-ttu-id="014e8-171">**Connection, proprietà**</span><span class="sxs-lookup"><span data-stu-id="014e8-171">**Connection property**</span></span>|<span data-ttu-id="014e8-172">**Valore**</span><span class="sxs-lookup"><span data-stu-id="014e8-172">**Value**</span></span>|
|:-----|:-----|
|<span data-ttu-id="014e8-173">**Direzione del traffico di rete**</span><span class="sxs-lookup"><span data-stu-id="014e8-173">**Network traffic direction**</span></span> <br/> |<span data-ttu-id="014e8-174">Inbound</span><span class="sxs-lookup"><span data-stu-id="014e8-174">Inbound</span></span>  <br/> |
|<span data-ttu-id="014e8-175">**Servizio**</span><span class="sxs-lookup"><span data-stu-id="014e8-175">**Service**</span></span> <br/> |<span data-ttu-id="014e8-176">Ambiente Exchange ibrido</span><span class="sxs-lookup"><span data-stu-id="014e8-176">Exchange Hybrid</span></span>  <br/> |
|<span data-ttu-id="014e8-177">**Office pubblico 365 endpoint (origine)**</span><span class="sxs-lookup"><span data-stu-id="014e8-177">**Public Office 365 endpoint (source)**</span></span> <br/> |<span data-ttu-id="014e8-178">Exchange Online (indirizzi IP)</span><span class="sxs-lookup"><span data-stu-id="014e8-178">Exchange Online (IP addresses)</span></span>  <br/> |
|<span data-ttu-id="014e8-179">**Endpoint pubblico locale (destinazione)**</span><span class="sxs-lookup"><span data-stu-id="014e8-179">**Public On-Premises Endpoint (destination)**</span></span> <br/> |<span data-ttu-id="014e8-180">5.5.5.5</span><span class="sxs-lookup"><span data-stu-id="014e8-180">5.5.5.5</span></span>  <br/> |
|<span data-ttu-id="014e8-181">**Voce DNS pubblica (Internet)**</span><span class="sxs-lookup"><span data-stu-id="014e8-181">**Public (Internet) DNS entry**</span></span> <br/> |<span data-ttu-id="014e8-182">Autodiscover.contoso.com</span><span class="sxs-lookup"><span data-stu-id="014e8-182">Autodiscover.contoso.com</span></span>  <br/> |
|<span data-ttu-id="014e8-183">**Questo endpoint locale verrà utilizzato per altri servizi Microsoft (non Office 365)**</span><span class="sxs-lookup"><span data-stu-id="014e8-183">**Will this on-premises endpoint be used for by other (non-Office 365) Microsoft services**</span></span> <br/> |<span data-ttu-id="014e8-184">No</span><span class="sxs-lookup"><span data-stu-id="014e8-184">No</span></span>  <br/> |
|<span data-ttu-id="014e8-185">**Questo endpoint locale verrà utilizzato dagli utenti/sistemi su Internet**</span><span class="sxs-lookup"><span data-stu-id="014e8-185">**Will this on-premises endpoint be used by users/systems on the Internet**</span></span> <br/> |<span data-ttu-id="014e8-186">Sì</span><span class="sxs-lookup"><span data-stu-id="014e8-186">Yes</span></span>  <br/> |
|<span data-ttu-id="014e8-187">**Sistemi interni pubblicati tramite endpoint pubblici**</span><span class="sxs-lookup"><span data-stu-id="014e8-187">**Internal systems published through public endpoints**</span></span> <br/> |<span data-ttu-id="014e8-188">Ruolo di accesso client di Exchange Server (locale) 192.168.101, 192.168.102, 192.168.103</span><span class="sxs-lookup"><span data-stu-id="014e8-188">Exchange Server client access role (on-premises) 192.168.101, 192.168.102, 192.168.103</span></span>  <br/> |
|<span data-ttu-id="014e8-189">**Annuncio IP dell'endpoint pubblico**</span><span class="sxs-lookup"><span data-stu-id="014e8-189">**IP advertisement of the public endpoint**</span></span> <br/> |<span data-ttu-id="014e8-190">**A Internet**: 5.5.0.0/16</span><span class="sxs-lookup"><span data-stu-id="014e8-190">**To Internet**: 5.5.0.0/16</span></span>  <br/> <span data-ttu-id="014e8-191">**A ExpressRoute**: 5.5.5.0/24</span><span class="sxs-lookup"><span data-stu-id="014e8-191">**To ExpressRoute**: 5.5.5.0/24</span></span>  <br/> |
|<span data-ttu-id="014e8-192">**Controlli di sicurezza/perimetrale**</span><span class="sxs-lookup"><span data-stu-id="014e8-192">**Security/Perimeter Controls**</span></span> <br/> |<span data-ttu-id="014e8-193">**Percorso Internet**: DeviceID_002</span><span class="sxs-lookup"><span data-stu-id="014e8-193">**Internet path**: DeviceID_002</span></span>  <br/> <span data-ttu-id="014e8-194">**Percorso ExpressRoute**: DeviceID_003</span><span class="sxs-lookup"><span data-stu-id="014e8-194">**ExpressRoute path**: DeviceID_003</span></span>  <br/> |
|<span data-ttu-id="014e8-195">**Disponibilità elevata**</span><span class="sxs-lookup"><span data-stu-id="014e8-195">**High Availability**</span></span> <br/> |<span data-ttu-id="014e8-196">Attivo/attivo in due spaziatura geografica ridondante</span><span class="sxs-lookup"><span data-stu-id="014e8-196">Active/Active across 2 geo-redundant</span></span>  <br/> <span data-ttu-id="014e8-197">Circuiti di ExpressRoute-Chicago e Dallas</span><span class="sxs-lookup"><span data-stu-id="014e8-197">ExpressRoute circuits - Chicago and Dallas</span></span>  <br/> |
|<span data-ttu-id="014e8-198">**Controllo della simmetria del percorso**</span><span class="sxs-lookup"><span data-stu-id="014e8-198">**Path symmetry control**</span></span> <br/> |<span data-ttu-id="014e8-199">**Metodo**: NAT di origine</span><span class="sxs-lookup"><span data-stu-id="014e8-199">**Method**: Source NAT</span></span>  <br/> <span data-ttu-id="014e8-200">**Percorso Internet**: connessioni NAT di origine in ingresso a 192.168.5.5</span><span class="sxs-lookup"><span data-stu-id="014e8-200">**Internet path**: Source NAT inbound connections to 192.168.5.5</span></span>  <br/> |<span data-ttu-id="014e8-201">**Percorso ExpressRoute**: connessioni NAT di origine a 192.168.1.0 (Chicago) e 192.168.2.0 (Dallas)</span><span class="sxs-lookup"><span data-stu-id="014e8-201">**ExpressRoute path**: Source NAT connections to 192.168.1.0 (Chicago) and 192.168.2.0 (Dallas)</span></span>  <br/> |

<span data-ttu-id="014e8-202">Ecco un esempio di un servizio in uscita solo:</span><span class="sxs-lookup"><span data-stu-id="014e8-202">Here's a sample of a service that is outbound only:</span></span>

|<span data-ttu-id="014e8-203">**Connection, proprietà**</span><span class="sxs-lookup"><span data-stu-id="014e8-203">**Connection property**</span></span>|<span data-ttu-id="014e8-204">**Valore**</span><span class="sxs-lookup"><span data-stu-id="014e8-204">**Value**</span></span>|
|:-----|:-----|
|<span data-ttu-id="014e8-205">**Direzione del traffico di rete**</span><span class="sxs-lookup"><span data-stu-id="014e8-205">**Network traffic direction**</span></span> <br/> |<span data-ttu-id="014e8-206">In uscita</span><span class="sxs-lookup"><span data-stu-id="014e8-206">Outbound</span></span>  <br/> |
|<span data-ttu-id="014e8-207">**Servizio**</span><span class="sxs-lookup"><span data-stu-id="014e8-207">**Service**</span></span> <br/> |<span data-ttu-id="014e8-208">SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="014e8-208">SharePoint Online</span></span>  <br/> |
|<span data-ttu-id="014e8-209">**Endpoint locale (origine)**</span><span class="sxs-lookup"><span data-stu-id="014e8-209">**On-premises endpoint (source)**</span></span> <br/> |<span data-ttu-id="014e8-210">Workstation utente</span><span class="sxs-lookup"><span data-stu-id="014e8-210">User workstation</span></span>  <br/> |
|<span data-ttu-id="014e8-211">**Office pubblico 365 endpoint (destinazione)**</span><span class="sxs-lookup"><span data-stu-id="014e8-211">**Public Office 365 endpoint (destination)**</span></span> <br/> |<span data-ttu-id="014e8-212">SharePoint Online (indirizzi IP)</span><span class="sxs-lookup"><span data-stu-id="014e8-212">SharePoint Online (IP addresses)</span></span>  <br/> |
|<span data-ttu-id="014e8-213">**Voce DNS pubblica (Internet)**</span><span class="sxs-lookup"><span data-stu-id="014e8-213">**Public (Internet) DNS entry**</span></span> <br/> |<span data-ttu-id="014e8-214">\*. sharepoint.com (e FQDN aggiuntivi)</span><span class="sxs-lookup"><span data-stu-id="014e8-214">\*.sharepoint.com (and additional FQDNs)</span></span>  <br/> |
|<span data-ttu-id="014e8-215">**Riferimenti alla rete CDN**</span><span class="sxs-lookup"><span data-stu-id="014e8-215">**CDN Referrals**</span></span> <br/> |<span data-ttu-id="014e8-216">cdn.sharepointonline.com (e altri FQDN)-indirizzi IP gestiti da provider della rete CDN)</span><span class="sxs-lookup"><span data-stu-id="014e8-216">cdn.sharepointonline.com (and additional FQDNs) - IP addresses maintained by CDN providers)</span></span>  <br/> |
|<span data-ttu-id="014e8-217">**Annuncio pubblicitario IP e NAT in uso**</span><span class="sxs-lookup"><span data-stu-id="014e8-217">**IP advertisement and NAT in use**</span></span> <br/> |<span data-ttu-id="014e8-218">**Percorso Internet/NAT di origine**: 1.1.1.0/24</span><span class="sxs-lookup"><span data-stu-id="014e8-218">**Internet path/Source NAT**: 1.1.1.0/24</span></span>  <br/> <span data-ttu-id="014e8-219">**ExpressRoute Path/Source NAT**: 1.1.2.0/24 (Chicago) e 1.1.3.0/24 (Dallas)</span><span class="sxs-lookup"><span data-stu-id="014e8-219">**ExpressRoute path/Source NAT**: 1.1.2.0/24 (Chicago) and 1.1.3.0/24 (Dallas)</span></span>  <br/> |
|<span data-ttu-id="014e8-220">**Connectivity, metodo**</span><span class="sxs-lookup"><span data-stu-id="014e8-220">**Connectivity method**</span></span> <br/> |<span data-ttu-id="014e8-221">**Internet**: tramite proxy Layer 7 (file. PAC)</span><span class="sxs-lookup"><span data-stu-id="014e8-221">**Internet**: via layer 7 proxy (.pac file)</span></span>  <br/> <span data-ttu-id="014e8-222">**ExpressRoute**: Direct routing (nessun proxy)</span><span class="sxs-lookup"><span data-stu-id="014e8-222">**ExpressRoute**: direct routing (no proxy)</span></span>  <br/> |
|<span data-ttu-id="014e8-223">**Controlli di sicurezza/perimetrale**</span><span class="sxs-lookup"><span data-stu-id="014e8-223">**Security/Perimeter Controls**</span></span> <br/> |<span data-ttu-id="014e8-224">**Percorso Internet**: DeviceID_002</span><span class="sxs-lookup"><span data-stu-id="014e8-224">**Internet path**: DeviceID_002</span></span>  <br/> <span data-ttu-id="014e8-225">**Percorso ExpressRoute**: DeviceID_003</span><span class="sxs-lookup"><span data-stu-id="014e8-225">**ExpressRoute path**: DeviceID_003</span></span>  <br/> |
|<span data-ttu-id="014e8-226">**Disponibilità elevata**</span><span class="sxs-lookup"><span data-stu-id="014e8-226">**High Availability**</span></span> <br/> |<span data-ttu-id="014e8-227">**Percorso Internet**: uscita Internet ridondante</span><span class="sxs-lookup"><span data-stu-id="014e8-227">**Internet path**: Redundant internet egress</span></span>  <br/> <span data-ttu-id="014e8-228">**Percorso ExpressRoute**: instradamento attivo/attivo ' Hot Potato ' in 2 circuiti ExpressRoute Geo-ridondanti-Chicago e Dallas</span><span class="sxs-lookup"><span data-stu-id="014e8-228">**ExpressRoute path**: Active/Active 'hot potato' routing across 2 geo-redundant ExpressRoute circuits - Chicago and Dallas</span></span>  <br/> |
|<span data-ttu-id="014e8-229">**Controllo della simmetria del percorso**</span><span class="sxs-lookup"><span data-stu-id="014e8-229">**Path symmetry control**</span></span> <br/> |<span data-ttu-id="014e8-230">**Metodo**: NAT di origine per tutte le connessioni</span><span class="sxs-lookup"><span data-stu-id="014e8-230">**Method**: Source NAT for all connections</span></span>  <br/> |

### <a name="your-network-topology-design-with-regional-connectivity"></a><span data-ttu-id="014e8-231">Progettazione della topologia di rete con connettività regionale</span><span class="sxs-lookup"><span data-stu-id="014e8-231">Your network topology design with regional connectivity</span></span>
<span data-ttu-id="014e8-232"><a name="topology"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-232"></span></span>

<span data-ttu-id="014e8-233">Dopo aver compreso i servizi e i flussi di traffico di rete associati, è possibile creare un diagramma reticolare che incorpora questi nuovi requisiti di connettività e illustra le modifiche apportate per l'utilizzo di ExpressRoute per Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-233">Once you understand the services and their associated network traffic flows, you can create a network diagram that incorporates these new connectivity requirements and illustrates the changes you'll make to use ExpressRoute for Office 365.</span></span> <span data-ttu-id="014e8-234">Il diagramma deve includere:</span><span class="sxs-lookup"><span data-stu-id="014e8-234">Your diagram should include:</span></span>
  
1. <span data-ttu-id="014e8-235">Tutte le posizioni degli utenti a cui si accede a Office 365 e ad altri servizi.</span><span class="sxs-lookup"><span data-stu-id="014e8-235">All user locations where Office 365 and other services will be accessed from.</span></span>

2. <span data-ttu-id="014e8-236">Tutti i punti di uscita Internet e ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-236">All internet and ExpressRoute egress points.</span></span>

3. <span data-ttu-id="014e8-237">Tutti i dispositivi in uscita e in ingresso che gestiscono la connettività all'interno e all'esterno della rete, inclusi router, firewall, server proxy di applicazione e rilevamento intrusione/prevenzione.</span><span class="sxs-lookup"><span data-stu-id="014e8-237">All outbound and inbound devices that manage connectivity in and out of the network, including routers, firewalls, application proxy servers, and intrusion detection/prevention.</span></span>

4. <span data-ttu-id="014e8-238">Destinazioni interne per tutto il traffico in ingresso, ad esempio i server ADFS interni che accettano connessioni dai server proxy dell'applicazione Web ADFS.</span><span class="sxs-lookup"><span data-stu-id="014e8-238">Internal destinations for all inbound traffic, such as internal ADFS servers that accept connections from the ADFS web application proxy servers.</span></span>

5. <span data-ttu-id="014e8-239">Catalogo di tutte le subnet IP che verranno pubblicizzate</span><span class="sxs-lookup"><span data-stu-id="014e8-239">Catalog of all IP subnets that will be advertised</span></span>

6. <span data-ttu-id="014e8-240">Identificare ogni percorso in cui gli utenti accedono a Office 365 e elencano i percorsi Meet-me che verranno utilizzati per ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-240">Identify each location where people will access Office 365 from and list the meet-me locations that will be used for ExpressRoute.</span></span>

7. <span data-ttu-id="014e8-241">Percorsi e parti della topologia di rete interna, in cui i prefissi di Microsoft IP appresi da ExpressRoute verranno accettati, filtrati e propagati.</span><span class="sxs-lookup"><span data-stu-id="014e8-241">Locations and portions of your internal network topology, where Microsoft IP prefixes learned from ExpressRoute will be accepted, filtered and propagated to.</span></span>

8. <span data-ttu-id="014e8-242">La topologia di rete dovrebbe illustrare la posizione geografica di ogni segmento di rete e il modo in cui si connette alla rete Microsoft tramite ExpressRoute e/o Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-242">The network topology should illustrate the geographic location of each network segment and how it connects to the Microsoft network over ExpressRoute and/or the Internet.</span></span>

<span data-ttu-id="014e8-243">Nel diagramma seguente vengono illustrate tutte le posizioni in cui gli utenti utilizzeranno Office 365 insieme agli annunci di routing in ingresso e in uscita a Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-243">The diagram below shows each location where people will be using Office 365 from along with the inbound and outbound routing advertisements to Office 365.</span></span>
  
![Meet-me geografica regionale di ExpressRoute](media/d866b36b-49bf-416b-af1b-d054e24989d2.png)
  
<span data-ttu-id="014e8-245">Per il traffico in uscita, gli utenti accedono a Office 365 in uno dei tre modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="014e8-245">For outbound traffic, the people access Office 365 in one of three ways:</span></span>
  
1. <span data-ttu-id="014e8-246">Tramite una posizione di Meet-me in Nord America per gli utenti in California.</span><span class="sxs-lookup"><span data-stu-id="014e8-246">Through a meet-me location in North America for the people in California.</span></span>

2. <span data-ttu-id="014e8-247">Tramite una location Meet-me a Hong Kong per gli utenti di Hong Kong.</span><span class="sxs-lookup"><span data-stu-id="014e8-247">Through a meet-me location in Hong Kong for the people in Hong Kong.</span></span>

3. <span data-ttu-id="014e8-248">Tramite Internet in Bangladesh dove sono presenti meno persone e non viene effettuato il provisioning di un circuito di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-248">Through the internet in Bangladesh where there are fewer people and no ExpressRoute circuit provisioned.</span></span>

![Connessioni in uscita per il diagramma regionale](media/8319943d-08f0-4781-9ef3-d23de2ad4671.png)
  
<span data-ttu-id="014e8-250">Analogamente, il traffico di rete in ingresso proveniente da Office 365 restituisce uno dei tre modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="014e8-250">Similarly, the inbound network traffic from Office 365 returns in one of three ways:</span></span>
  
1. <span data-ttu-id="014e8-251">Tramite una posizione di Meet-me in Nord America per gli utenti in California.</span><span class="sxs-lookup"><span data-stu-id="014e8-251">Through a meet-me location in North America for the people in California.</span></span>

2. <span data-ttu-id="014e8-252">Tramite una location Meet-me a Hong Kong per gli utenti di Hong Kong.</span><span class="sxs-lookup"><span data-stu-id="014e8-252">Through a meet-me location in Hong Kong for the people in Hong Kong.</span></span>

3. <span data-ttu-id="014e8-253">Tramite Internet in Bangladesh dove sono presenti meno persone e non viene effettuato il provisioning di un circuito di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-253">Through the internet in Bangladesh where there are fewer people and no ExpressRoute circuit provisioned.</span></span>

![Connessioni in ingresso per il diagramma regionale](media/d6d6160d-bf28-4de3-a787-186c7432b306.png)
  
### <a name="determine-the-appropriate-meet-me-location"></a><span data-ttu-id="014e8-255">Determinare il percorso di riunione appropriato</span><span class="sxs-lookup"><span data-stu-id="014e8-255">Determine the appropriate meet-me location</span></span>

<span data-ttu-id="014e8-256">La selezione delle posizioni Meet-me, ovvero la posizione fisica in cui il circuito di ExpressRoute connette la rete alla rete Microsoft, è influenzata dai percorsi in cui gli utenti accedono a Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-256">The selection of meet-me locations, which are the physical location where your ExpressRoute circuit connects your network to the Microsoft network, is influenced by the locations where people will access Office 365 from.</span></span> <span data-ttu-id="014e8-257">Come offerta SaaS, Office 365 non funziona con il modello regionale IaaS o PaaS nello stesso modo in cui è Azure.</span><span class="sxs-lookup"><span data-stu-id="014e8-257">As a SaaS offering, Office 365 does not operate under the IaaS or PaaS regional model in the same way Azure does.</span></span> <span data-ttu-id="014e8-258">Invece, Office 365 è un insieme distribuito di servizi di collaborazione, in cui gli utenti possono dover connettersi a endpoint su più datacenter e aree geografiche, che potrebbero non essere necessariamente nello stesso percorso o nell'area in cui è ospitato il tenant dell'utente.</span><span class="sxs-lookup"><span data-stu-id="014e8-258">Instead, Office 365 is a distributed set of collaboration services, where users may need to connect to endpoints across multiple datacenters and regions, which may not necessarily be in the same location or region where the user's tenant is hosted.</span></span>
  
<span data-ttu-id="014e8-259">Questo significa che la considerazione più importante da fare quando si selezionano le posizioni Meet-me per ExpressRoute per Office 365 è quella in cui le persone all'interno dell'organizzazione si connetteranno.</span><span class="sxs-lookup"><span data-stu-id="014e8-259">This means the most important consideration you need to make when selecting meet-me locations for ExpressRoute for Office 365 is where the people in your organization will be connecting from.</span></span> <span data-ttu-id="014e8-260">La raccomandazione generale per la connettività ottimale di Office 365 è l'implementazione del routing, in modo che le richieste degli utenti ai servizi di Office 365 vengano distribuite nella rete Microsoft tramite il percorso di rete più breve, anche questo viene spesso definito "Hot Potato".</span><span class="sxs-lookup"><span data-stu-id="014e8-260">The general recommendation for optimal Office 365 connectivity is implement routing, so that user requests to Office 365 services are handed off into the Microsoft network over the shortest network path, this is also often being referred to as 'hot potato' routing.</span></span> <span data-ttu-id="014e8-261">Ad esempio, se la maggior parte degli utenti di Office 365 si trova in una o due posizioni, la selezione dei percorsi Meet-me che si trovano nelle immediate vicinanze del percorso di tali utenti creerà la struttura ottimale.</span><span class="sxs-lookup"><span data-stu-id="014e8-261">For example, if most of the Office 365 users are in one or two locations, selecting meet-me locations that are in the closest proximity to the location of those users will create the optimal design.</span></span> <span data-ttu-id="014e8-262">Se l'azienda dispone di popolazioni di utenti di grandi dimensioni in molte aree geografiche diverse, è possibile prendere in considerazione la possibilità di disporre di più circuiti ExpressRoute e posizioni Meet-me.</span><span class="sxs-lookup"><span data-stu-id="014e8-262">If your company has large user populations in many different regions, you may want to consider having multiple ExpressRoute circuits and meet-me locations.</span></span> <span data-ttu-id="014e8-263">Per alcune delle posizioni degli utenti, il percorso più breve/ottimale in Microsoft Network e Office 365, potrebbe non essere tramite la rete WAN interna e i punti di ExpressRoute Meet-me, ma tramite Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-263">For some of your user locations, the shortest/most optimal path into Microsoft network and Office 365, may not be through your internal WAN and ExpressRoute meet-me points, but via the Internet.</span></span>
  
<span data-ttu-id="014e8-264">Spesso, sono disponibili più posizioni Meet-me che possono essere selezionate all'interno di un'area con relativa vicinanza agli utenti.</span><span class="sxs-lookup"><span data-stu-id="014e8-264">Often times, there are multiple meet-me locations that could be selected within a region with relative proximity to your users.</span></span> <span data-ttu-id="014e8-265">Compilare la tabella seguente per guidare le proprie decisioni.</span><span class="sxs-lookup"><span data-stu-id="014e8-265">Fill out the following table to guide your decisions.</span></span>

|<span data-ttu-id="014e8-266">**Planned ExpressRoute Meet-me Locations in California e New York**</span><span class="sxs-lookup"><span data-stu-id="014e8-266">**Planned ExpressRoute meet-me locations in California and New York**</span></span>||
|:-----|:-----|
|<span data-ttu-id="014e8-267">Posizione</span><span class="sxs-lookup"><span data-stu-id="014e8-267">Location</span></span>  <br/> |<span data-ttu-id="014e8-268">Numero di persone</span><span class="sxs-lookup"><span data-stu-id="014e8-268">Number of people</span></span>  <br/> |<span data-ttu-id="014e8-269">Latenza prevista per la rete Microsoft tramite l'uscita Internet</span><span class="sxs-lookup"><span data-stu-id="014e8-269">Expected latency to Microsoft network over Internet egress</span></span>  <br/> |<span data-ttu-id="014e8-270">Latenza prevista per Microsoft Network over ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="014e8-270">Expected latency to Microsoft network over ExpressRoute</span></span>  <br/> |
|<span data-ttu-id="014e8-271">Roma</span><span class="sxs-lookup"><span data-stu-id="014e8-271">Los Angeles</span></span>  <br/> |<span data-ttu-id="014e8-272">10,000</span><span class="sxs-lookup"><span data-stu-id="014e8-272">10,000</span></span>  <br/> |<span data-ttu-id="014e8-273">~ 15ms</span><span class="sxs-lookup"><span data-stu-id="014e8-273">~15ms</span></span>  <br/> |<span data-ttu-id="014e8-274">~ 10ms (tramite Silicon Valley)</span><span class="sxs-lookup"><span data-stu-id="014e8-274">~10ms (via Silicon Valley)</span></span>  <br/> |
|<span data-ttu-id="014e8-275">Washington D.C.</span><span class="sxs-lookup"><span data-stu-id="014e8-275">Washington DC</span></span>  <br/> |<span data-ttu-id="014e8-276">15.000</span><span class="sxs-lookup"><span data-stu-id="014e8-276">15,000</span></span>  <br/> |<span data-ttu-id="014e8-277">~ 20ms</span><span class="sxs-lookup"><span data-stu-id="014e8-277">~20ms</span></span>  <br/> |<span data-ttu-id="014e8-278">~ 10ms (via New York)</span><span class="sxs-lookup"><span data-stu-id="014e8-278">~10ms (via New York)</span></span>  <br/> |
|<span data-ttu-id="014e8-279">Dallas</span><span class="sxs-lookup"><span data-stu-id="014e8-279">Dallas</span></span>  <br/> |<span data-ttu-id="014e8-280">5,000</span><span class="sxs-lookup"><span data-stu-id="014e8-280">5,000</span></span>  <br/> |<span data-ttu-id="014e8-281">~ 15ms</span><span class="sxs-lookup"><span data-stu-id="014e8-281">~15ms</span></span>  <br/> |<span data-ttu-id="014e8-282">~ 40ms (via New York)</span><span class="sxs-lookup"><span data-stu-id="014e8-282">~40ms (via New York)</span></span>  <br/> |

<span data-ttu-id="014e8-283">Una volta che l'architettura di rete globale che mostra l'area di Office 365, i percorsi Meet-me del provider di servizi di rete di ExpressRoute e la quantità di persone per località è stata sviluppata, può essere utilizzata per identificare se è possibile effettuare eventuali ottimizzazioni.</span><span class="sxs-lookup"><span data-stu-id="014e8-283">Once the global network architecture showing the Office 365 region, ExpressRoute network service provider meet-me locations, and the quantity of people by location has been developed, it can be used to identify if any optimizations can be made.</span></span> <span data-ttu-id="014e8-284">Può anche mostrare connessioni di rete tornanti globali in cui le rotte del traffico in una posizione distante per ottenere la posizione Meet-me.</span><span class="sxs-lookup"><span data-stu-id="014e8-284">It may also show global hairpin network connections where traffic routes to a distant location in order to get the meet-me location.</span></span> <span data-ttu-id="014e8-285">Se viene individuato un tornante sulla rete globale, è necessario aggiornarlo prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="014e8-285">If a hairpin on the global network is discovered it should be remediated before continuing.</span></span> <span data-ttu-id="014e8-286">Trova un'altra posizione Meet-me oppure usa i punti di uscita di breakout Internet selettivi per evitare la tornante.</span><span class="sxs-lookup"><span data-stu-id="014e8-286">Either find another meet-me location, or use selective Internet breakout egress points to avoid the hairpin.</span></span>
  
<span data-ttu-id="014e8-287">Nel primo diagramma viene illustrato un esempio di un cliente con due posizioni fisiche in Nord America.</span><span class="sxs-lookup"><span data-stu-id="014e8-287">The first diagram, shows an example of a customer with two physical locations in North America.</span></span> <span data-ttu-id="014e8-288">È possibile visualizzare le informazioni sui percorsi di Office, le posizioni tenant di Office 365 e diverse opzioni per le posizioni di ExpressRoute Meet-me.</span><span class="sxs-lookup"><span data-stu-id="014e8-288">You can see the information about office locations, Office 365 tenant locations, and several choices for ExpressRoute meet-me locations.</span></span> <span data-ttu-id="014e8-289">In questo esempio, il cliente ha selezionato la posizione Meet-me in base a due principi, nell'ordine indicato:</span><span class="sxs-lookup"><span data-stu-id="014e8-289">In this example, the customer has selected the meet-me location based on two principles, in order:</span></span>
  
1. <span data-ttu-id="014e8-290">Prossimità più vicina alle persone nell'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="014e8-290">Closest proximity to the people in their organization.</span></span>

2. <span data-ttu-id="014e8-291">Più vicino a un datacenter Microsoft in cui è ospitato Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-291">Closest in proximity to a Microsoft datacenter where Office 365 is hosted.</span></span>

![ExpressRoute US Geographic Meet-me](media/5ec38274-b317-4ec1-91c8-90c2a7fd32ca.png)
  
<span data-ttu-id="014e8-293">Espandendo questo concetto leggermente oltre, nel secondo diagramma viene mostrato un esempio di cliente multi-nazionale di fronte a informazioni e processi decisionali simili.</span><span class="sxs-lookup"><span data-stu-id="014e8-293">Expanding this concept slightly further, the second diagram shows an example multi-national customer faced with similar information and decision making.</span></span> <span data-ttu-id="014e8-294">Questo cliente ha un piccolo ufficio in Bangladesh con solo un piccolo team di dieci persone incentrato sulla crescita del proprio ingombro nella regione.</span><span class="sxs-lookup"><span data-stu-id="014e8-294">This customer has a small office in Bangladesh with only a small team of ten people focused on growing their footprint in the region.</span></span> <span data-ttu-id="014e8-295">Vi è una posizione Meet-me a Chennai e un datacenter Microsoft con Office 365 ospitato in Chennai quindi una posizione di Meet-me avrebbe senso; Tuttavia, per dieci persone, la spesa del circuito aggiuntivo è gravosa.</span><span class="sxs-lookup"><span data-stu-id="014e8-295">There is a meet-me location in Chennai and a Microsoft datacenter with Office 365 hosted in Chennai so a meet-me location would make sense; however, for ten people, the expense of the additional circuit is burdensome.</span></span> <span data-ttu-id="014e8-296">Quando si guarda la rete, è necessario determinare se la latenza coinvolta nell'invio del traffico di rete in tutta la rete è più efficace rispetto alla spesa del capitale per acquisire un altro circuito di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-296">As you look at your network, you'll need to determine if the latency involved in sending your network traffic across your network is more effective than spending the capital to acquire another ExpressRoute circuit.</span></span>
  
<span data-ttu-id="014e8-297">In alternativa, le dieci persone in Bangladesh potrebbero migliorare le prestazioni con il traffico di rete inviato tramite Internet alla rete Microsoft piuttosto che instradarlo sulla propria rete interna, come mostrato nei diagrammi introduttivi e riprodotte seguito.</span><span class="sxs-lookup"><span data-stu-id="014e8-297">Alternatively, the ten people in Bangladesh may experience better performance with their network traffic sent over the internet to the Microsoft network than they would routing on their internal network as we showed in the introductory diagrams and reproduced below.</span></span>
  
![Connessioni in uscita per il diagramma regionale](media/8319943d-08f0-4781-9ef3-d23de2ad4671.png)
  
## <a name="create-your-expressroute-for-office-365-implementation-plan"></a><span data-ttu-id="014e8-299">Creare il piano di implementazione di ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-299">Create your ExpressRoute for Office 365 implementation plan</span></span>
<span data-ttu-id="014e8-300"><a name="implementation"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-300"></span></span>

<span data-ttu-id="014e8-301">Il piano di implementazione deve comprendere sia i dettagli tecnici della configurazione di ExpressRoute, sia i dettagli della configurazione di tutte le altre infrastrutture della rete, ad esempio le seguenti.</span><span class="sxs-lookup"><span data-stu-id="014e8-301">Your implementation plan should encompass both the technical details of configuring ExpressRoute as well as the details of configuring all the other infrastructure on your network, such as the following.</span></span>
  
- <span data-ttu-id="014e8-302">Pianificare i servizi suddivisi tra ExpressRoute e Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-302">Plan which services split between ExpressRoute and Internet.</span></span>

- <span data-ttu-id="014e8-303">Pianificare la larghezza di banda, la sicurezza, la disponibilità elevata e il failover.</span><span class="sxs-lookup"><span data-stu-id="014e8-303">Plan for bandwidth, security, high availability and failover.</span></span>

- <span data-ttu-id="014e8-304">Progettare il routing in ingresso e in uscita, incluse le ottimizzazioni del percorso di routing appropriate per le diverse posizioni</span><span class="sxs-lookup"><span data-stu-id="014e8-304">Design inbound and outbound routing, including proper routing path optimizations for different locations</span></span>

- <span data-ttu-id="014e8-305">Decidere in che modo i percorsi di ExpressRoute verranno pubblicizzati nella propria rete e qual è il meccanismo che consente ai client di selezionare il percorso Internet o ExpressRoute; ad esempio, Direct routing o proxy di applicazione.</span><span class="sxs-lookup"><span data-stu-id="014e8-305">Decide how far ExpressRoute routes will be advertised into your network and what is the mechanism for clients to select Internet or ExpressRoute path; for example, direct routing or application proxy.</span></span>

- <span data-ttu-id="014e8-306">Pianificare le modifiche ai record DNS, incluse le voci del [Framework del criterio mittente](https://technet.microsoft.com/library/dn789058%28v=exchg.150%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="014e8-306">Plan DNS record changes, including [Sender Policy Framework](https://technet.microsoft.com/library/dn789058%28v=exchg.150%29.aspx) entries.</span></span>

- <span data-ttu-id="014e8-307">Pianificare la strategia NAT, inclusi i NAT in uscita e in ingresso.</span><span class="sxs-lookup"><span data-stu-id="014e8-307">Plan NAT strategy including outbound and inbound source NAT.</span></span>

### <a name="plan-your-routing-with-both-internet-and-expressroute-network-paths"></a><span data-ttu-id="014e8-308">Pianificare il routing con percorsi di rete sia Internet che ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="014e8-308">Plan your routing with both internet and ExpressRoute network paths</span></span>
<span data-ttu-id="014e8-309"><a name="paths"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-309"></span></span>

- <span data-ttu-id="014e8-310">Per la distribuzione iniziale, tutti i servizi in ingresso, come la posta elettronica in ingresso o la connettività ibrida, sono consigliati per l'utilizzo di Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-310">For your initial deployment, all inbound services, such as inbound email or hybrid connectivity, are recommended to use the internet.</span></span>

- <span data-ttu-id="014e8-311">Pianificare la distribuzione della rete LAN dei client degli utenti finali, ad esempio [la configurazione di un file PAC/WPAD, la](https://aka.ms/manageo365endpoints)route predefinita, i server proxy e gli annunci route BGP.</span><span class="sxs-lookup"><span data-stu-id="014e8-311">Plan end user client LAN routing, such as [configuring a PAC/WPAD file](https://aka.ms/manageo365endpoints), default route, proxy servers, and BGP route advertisements.</span></span>

- <span data-ttu-id="014e8-312">Pianificare il routing perimetrale, inclusi i server proxy, i firewall e i proxy cloud.</span><span class="sxs-lookup"><span data-stu-id="014e8-312">Plan perimeter routing, including proxy servers, firewalls, and cloud proxies.</span></span>

### <a name="plan-your-bandwidth-security-high-availability-and-failover"></a><span data-ttu-id="014e8-313">Pianificare la larghezza di banda, la sicurezza, la disponibilità elevata e il failover</span><span class="sxs-lookup"><span data-stu-id="014e8-313">Plan your bandwidth, security, high availability and failover</span></span>
<span data-ttu-id="014e8-314"><a name="availability"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-314"></span></span>

<span data-ttu-id="014e8-315">Creare un piano per la larghezza di banda necessaria per ogni carico di lavoro principale di Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-315">Create a plan for bandwidth required for each major Office 365 workload.</span></span> <span data-ttu-id="014e8-316">Stimare separatamente i requisiti di larghezza di banda di Exchange Online, SharePoint Online e Skype for business online.</span><span class="sxs-lookup"><span data-stu-id="014e8-316">Separately estimate Exchange Online, SharePoint Online, and Skype for Business Online bandwidth requirements.</span></span> <span data-ttu-id="014e8-317">È possibile utilizzare i calcolatori di stima che sono stati forniti per Exchange Online e Skype for business come punto di partenza. Tuttavia, è necessario un test pilota con un campione rappresentativo dei profili utente e delle posizioni per comprendere appieno le esigenze di larghezza di banda della propria organizzazione.</span><span class="sxs-lookup"><span data-stu-id="014e8-317">You can use the estimation calculators we've provided for Exchange Online and Skype for Business as a starting place; however, a pilot test with a representative sample of the user profiles and locations is required to fully understand the bandwidth needs of your organization.</span></span>
  
<span data-ttu-id="014e8-318">Aggiungere la modalità di gestione della sicurezza in ogni Internet e la posizione di uscita di ExpressRoute al piano, tenere presente che tutte le connessioni di ExpressRoute a Office 365 utilizzano il peering pubblico e devono essere ancora protette in conformità con i criteri di sicurezza aziendali per la connessione a un ambiente esterno reti.</span><span class="sxs-lookup"><span data-stu-id="014e8-318">Add how security is handled at each internet and ExpressRoute egress location to your plan, remember all ExpressRoute connections to Office 365 use public peering and must still be secured in accordance with your company security policies of connecting to external networks.</span></span>
  
<span data-ttu-id="014e8-319">Aggiungere dettagli al piano di cui le persone saranno intaccate dal tipo di interruzione e in che modo queste persone potranno svolgere il proprio lavoro a piena capacità nel modo più semplice.</span><span class="sxs-lookup"><span data-stu-id="014e8-319">Add details to your plan about which people will be affected by what type of outage and how those people will be able to perform their work at full capacity in the simplest manner.</span></span>
  
#### <a name="plan-bandwidth-requirements-including-skype-for-business-requirements-on-jitter-latency-congestion-and-headroom"></a><span data-ttu-id="014e8-320">Pianificare i requisiti di larghezza di banda inclusi i requisiti di Skype for business su jitter, latenza, congestione e spazio di espansione</span><span class="sxs-lookup"><span data-stu-id="014e8-320">Plan bandwidth requirements including Skype for Business requirements on Jitter, Latency, Congestion, and Headroom</span></span>
  
<span data-ttu-id="014e8-321">Skype for business online dispone anche di requisiti di rete aggiuntivi specifici descritti nell'articolo [qualità multimediale e prestazioni della connettività di rete in Skype for business online](https://support.office.com/article/Media-Quality-and-Network-Connectivity-Performance-in-Skype-for-Business-Online-5fe3e01b-34cf-44e0-b897-b0b2a83f0917).</span><span class="sxs-lookup"><span data-stu-id="014e8-321">Skype for Business Online also has specific additional network requirements which are detailed in the article [Media Quality and Network Connectivity Performance in Skype for Business Online](https://support.office.com/article/Media-Quality-and-Network-Connectivity-Performance-in-Skype-for-Business-Online-5fe3e01b-34cf-44e0-b897-b0b2a83f0917).</span></span>
  
<span data-ttu-id="014e8-322">Leggere la sezione **pianificazione della larghezza di banda per Azure ExpressRoute** nella [pianificazione della rete con ExpressRoute per Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span><span class="sxs-lookup"><span data-stu-id="014e8-322">Read the section **Bandwidth planning for Azure ExpressRoute** in [Network planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span></span>
  
<span data-ttu-id="014e8-323">Quando si esegue una valutazione della larghezza di banda con gli utenti pilota, è possibile utilizzare la guida. [Ottimizzazione delle prestazioni di Office 365 utilizzando le linee di base e la cronologia delle prestazioni](https://support.office.com/article/Office-365-performance-tuning-using-baselines-and-performance-history-1492cb94-bd62-43e6-b8d0-2a61ed88ebae).</span><span class="sxs-lookup"><span data-stu-id="014e8-323">When performing a bandwidth assessment with your pilot users, you can use our guide; [Office 365 performance tuning using baselines and performance history](https://support.office.com/article/Office-365-performance-tuning-using-baselines-and-performance-history-1492cb94-bd62-43e6-b8d0-2a61ed88ebae).</span></span>
  
#### <a name="plan-for-high-availability-requirements"></a><span data-ttu-id="014e8-324">Pianificare i requisiti di disponibilità elevata</span><span class="sxs-lookup"><span data-stu-id="014e8-324">Plan for high availability requirements</span></span>
  
<span data-ttu-id="014e8-325">Creare un piano per la disponibilità elevata per soddisfare le proprie esigenze e incorporarlo nel diagramma della topologia di rete aggiornato.</span><span class="sxs-lookup"><span data-stu-id="014e8-325">Create a plan for high availability to meet your needs and incorporate this into your updated network topology diagram.</span></span> <span data-ttu-id="014e8-326">Leggere la sezione **High Availability and failover with Azure ExpressRoute** in [Network Planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span><span class="sxs-lookup"><span data-stu-id="014e8-326">Read the section **High availability and failover with Azure ExpressRoute** in [Network planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span></span>
  
#### <a name="plan-for-network-security-requirements"></a><span data-ttu-id="014e8-327">Pianificare i requisiti di sicurezza di rete</span><span class="sxs-lookup"><span data-stu-id="014e8-327">Plan for network security requirements</span></span>
  
<span data-ttu-id="014e8-328">Creare un piano per soddisfare i requisiti di sicurezza della rete e inserirlo nel diagramma della topologia di rete aggiornato.</span><span class="sxs-lookup"><span data-stu-id="014e8-328">Create a plan to meet your network security requirements and incorporate this into your updated network topology diagram.</span></span> <span data-ttu-id="014e8-329">Leggere la sezione **Applying Security Controls to Azure ExpressRoute for office 365 Scenarios** in [Network Planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span><span class="sxs-lookup"><span data-stu-id="014e8-329">Read the section **Applying security controls to Azure ExpressRoute for Office 365 scenarios** in [Network planning with ExpressRoute for Office 365](https://support.office.com/article/Network-planning-with-ExpressRoute-for-Office-365-103208f1-e788-4601-aa45-504f896511cd).</span></span>
  
### <a name="design-outbound-service-connectivity"></a><span data-ttu-id="014e8-330">Progettare la connettività dei servizi in uscita</span><span class="sxs-lookup"><span data-stu-id="014e8-330">Design outbound service connectivity</span></span>
<span data-ttu-id="014e8-331"><a name="outbound"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-331"></span></span>

<span data-ttu-id="014e8-332">ExpressRoute per Office 365 ha requisiti di rete in *uscita* che potrebbero non essere familiari.</span><span class="sxs-lookup"><span data-stu-id="014e8-332">ExpressRoute for Office 365 has  *outbound*  network requirements that may be unfamiliar.</span></span> <span data-ttu-id="014e8-333">In particolare, gli indirizzi IP che rappresentano gli utenti e le reti a Office 365 e agiscono come endpoint di origine per le connessioni di rete in uscita a Microsoft devono seguire i requisiti specifici descritti di seguito.</span><span class="sxs-lookup"><span data-stu-id="014e8-333">Specifically, the IP addresses that represent your users and networks to Office 365 and act as the source endpoints for outbound network connections to Microsoft must follow specific requirements outlined below.</span></span>
  
1. <span data-ttu-id="014e8-334">Gli endpoint devono essere indirizzi IP pubblici, registrati alla propria azienda o al vettore che fornisce la connettività di ExpressRoute all'utente.</span><span class="sxs-lookup"><span data-stu-id="014e8-334">The endpoints must be public IP addresses, that are registered to your company or to carrier providing ExpressRoute connectivity to you.</span></span>

2. <span data-ttu-id="014e8-335">Gli endpoint devono essere annunciati a Microsoft e convalidati/accettati da ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-335">The endpoints must be advertised to Microsoft and validated/accepted by ExpressRoute.</span></span>

3. <span data-ttu-id="014e8-336">Gli endpoint non devono essere pubblicizzati su Internet con la stessa metrica di routing preferita.</span><span class="sxs-lookup"><span data-stu-id="014e8-336">The endpoints must not be advertised to the Internet with the same or more preferred routing metric.</span></span>

4. <span data-ttu-id="014e8-337">Gli endpoint non devono essere utilizzati per la connettività ai servizi Microsoft che non sono configurati su ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-337">The endpoints must not be used for connectivity to Microsoft services that are not configured over ExpressRoute.</span></span>

<span data-ttu-id="014e8-338">Se la struttura di rete non soddisfa questi requisiti, è possibile che gli utenti verifichino problemi di connettività a Office 365 e ad altri servizi Microsoft per instradare la foratura nera o il routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="014e8-338">If your network design doesn't meet these requirements, there is a high risk your users will experience connectivity failures to Office 365 and other Microsoft services due to route black holing or asymmetric routing.</span></span> <span data-ttu-id="014e8-339">Questo problema si verifica quando le richieste ai servizi Microsoft vengono instradate su ExpressRoute, ma le risposte vengono instradate di nuovo su Internet o viceversa e le risposte vengono rimosse dai dispositivi di rete con stato, ad esempio i firewall.</span><span class="sxs-lookup"><span data-stu-id="014e8-339">This occurs when requests to Microsoft services are routed over ExpressRoute, but responses are routed back across the internet, or vice versa, and the responses are dropped by stateful network devices such as firewalls.</span></span>
  
<span data-ttu-id="014e8-340">Il metodo più comune che è possibile utilizzare per soddisfare i requisiti di cui sopra è l'utilizzo di NAT di origine, implementato come parte della rete o fornito dal gestore di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-340">The most common method you can use to meet the above requirements is to use source NAT, either implemented as a part of your network or provided by your ExpressRoute carrier.</span></span> <span data-ttu-id="014e8-341">NAT di origine consente di astrarre i dettagli e l'indirizzamento IP privato della rete Internet da ExpressRoute e; insieme agli annunci di route IP corretti, fornire un meccanismo semplice per garantire la simmetria del percorso.</span><span class="sxs-lookup"><span data-stu-id="014e8-341">Source NAT allows you to abstract the details and private IP addressing of your internet network from ExpressRoute and; coupled with proper IP route advertisements, provide an easy mechanism to ensure path symmetry.</span></span> <span data-ttu-id="014e8-342">Se si utilizzano dispositivi di rete con stato che sono specifici per le posizioni di peering di ExpressRoute, è necessario implementare pool NAT distinti per ogni peering di ExpressRoute per garantire la simmetria del percorso.</span><span class="sxs-lookup"><span data-stu-id="014e8-342">If you're using stateful network devices that are specific to ExpressRoute peering locations, you must implement separate NAT pools for each ExpressRoute peering to ensure path symmetry.</span></span>
  
<span data-ttu-id="014e8-343">Per ulteriori informazioni, vedere i [requisiti NAT di ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-nat/).</span><span class="sxs-lookup"><span data-stu-id="014e8-343">Read more about the [ExpressRoute NAT requirements](https://azure.microsoft.com/documentation/articles/expressroute-nat/).</span></span>
  
<span data-ttu-id="014e8-344">Aggiungere le modifiche per la connettività in uscita al diagramma di topologia di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-344">Add the changes for the outbound connectivity to the network topology diagram.</span></span>
  
### <a name="design-inbound-service-connectivity"></a><span data-ttu-id="014e8-345">Progettare la connettività dei servizi in ingresso</span><span class="sxs-lookup"><span data-stu-id="014e8-345">Design inbound service connectivity</span></span>
<span data-ttu-id="014e8-346"><a name="inbound"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-346"></span></span>

<span data-ttu-id="014e8-347">La maggior parte delle distribuzioni di Office 365 presuppone una qualche forma di connettività in ingresso da Office 365 a servizi locali, ad esempio per gli scenari ibridi di Exchange, SharePoint e Skype for business, le migrazioni delle cassette postali e l'autenticazione tramite ADFS infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="014e8-347">The majority of enterprise Office 365 deployments assume some form of inbound connectivity from Office 365 to on-premises services, such as for Exchange, SharePoint, and Skype for Business hybrid scenarios, mailbox migrations, and authentication using ADFS infrastructure.</span></span> <span data-ttu-id="014e8-348">Quando ExpressRoute si Abilita un ulteriore percorso di routing tra la rete locale e Microsoft per la connettività in uscita, queste connessioni in ingresso possono inavvertitamente influire sul routing asimmetrico, anche se si prevede di continuare a eseguire tali flussi utilizzare Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-348">When ExpressRoute you enable an additional routing path between your on-premises network and Microsoft for outbound connectivity, these inbound connections may inadvertently be impacted by asymmetric routing, even if you intend to have those flows continue to use the Internet.</span></span> <span data-ttu-id="014e8-349">Alcuni accorgimenti descritti di seguito sono consigliati per garantire che non vi siano effetti sui flussi in ingresso basati su Internet da Office 365 a sistemi locali.</span><span class="sxs-lookup"><span data-stu-id="014e8-349">A few precautions described below are recommended to ensure there is no impact to Internet based inbound flows from Office 365 to on-premises systems.</span></span>
  
<span data-ttu-id="014e8-350">Per ridurre al minimo i rischi del routing asimmetrico per i flussi del traffico di rete in ingresso, tutte le connessioni in ingresso devono utilizzare NAT di origine prima di essere instradate in segmenti della rete che dispongono di visibilità del routing in ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-350">To minimize the risks of asymmetric routing for inbound network traffic flows, all of the inbound connections should use source NAT before they're routed into segments of your network which have routing visibility into ExpressRoute.</span></span> <span data-ttu-id="014e8-351">Se le connessioni in ingresso sono consentite su un segmento di rete con visibilità del routing in ExpressRoute senza NAT di origine, le richieste provenienti da Office 365 entreranno da Internet, ma la risposta che torna a Office 365 preferirà la ExpressRoute percorso di rete di nuovo alla rete Microsoft, causando il routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="014e8-351">If the incoming connections are allowed onto a network segment with routing visibility into ExpressRoute without source NAT, requests originating from Office 365 will enter from the internet, but the response going back to Office 365 will prefer the ExpressRoute network path back to the Microsoft network, causing asymmetric routing.</span></span>
  
<span data-ttu-id="014e8-352">È possibile prendere in considerazione uno dei modelli di implementazione seguenti per soddisfare questo requisito:</span><span class="sxs-lookup"><span data-stu-id="014e8-352">You may consider one of the following implementation patterns to satisfy this requirement:</span></span>
  
1. <span data-ttu-id="014e8-353">Eseguire NAT di origine prima che le richieste vengano instradate nella rete interna utilizzando apparecchiature di rete, ad esempio firewall o di bilanciamento del carico, sul percorso da Internet ai sistemi locali.</span><span class="sxs-lookup"><span data-stu-id="014e8-353">Perform source NAT before requests are routed into your internal network using networking equipment such as firewalls or load balancers on the path from the Internet to your on-premises systems.</span></span>

2. <span data-ttu-id="014e8-354">Assicurarsi che le route di ExpressRoute non vengano propagate ai segmenti di rete in cui si trovano i servizi in ingresso, ad esempio i Front End Server o i sistemi proxy inversi, per la gestione delle connessioni Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-354">Ensure that ExpressRoute routes are not propagated to the network segments where inbound services, such as front end servers or reverse proxy systems, handling Internet connections reside.</span></span>

<span data-ttu-id="014e8-355">L'accounting esplicito di questi scenari nella rete e la conservazione di tutti i flussi del traffico di rete in ingresso su Internet consentono di ridurre al minimo la distribuzione e il rischio operativo del routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="014e8-355">Explicitly accounting for these scenarios in your network and keeping all inbound network traffic flows over the Internet helps to minimize deployment and operational risk of asymmetric routing.</span></span>
  
<span data-ttu-id="014e8-356">In alcuni casi, è possibile scegliere di indirizzare alcuni flussi in ingresso su connessioni ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-356">There may be cases where you may choose to direct some inbound flows over ExpressRoute connections.</span></span> <span data-ttu-id="014e8-357">Per questi scenari, tenere conto delle considerazioni aggiuntive seguenti.</span><span class="sxs-lookup"><span data-stu-id="014e8-357">For these scenarios, take the following additional considerations into account.</span></span>
  
1. <span data-ttu-id="014e8-358">Office 365 può solo individuare endpoint locali che utilizzano indirizzi IP pubblici.</span><span class="sxs-lookup"><span data-stu-id="014e8-358">Office 365 can only target on-premises endpoints that use public IPs.</span></span> <span data-ttu-id="014e8-359">Ciò significa che, anche se l'endpoint in ingresso locale è esposto solo a Office 365 su ExpressRoute, è comunque necessario che sia associato a un IP pubblico.</span><span class="sxs-lookup"><span data-stu-id="014e8-359">This means that even if the on-premises inbound endpoint is only exposed to Office 365 over ExpressRoute, it still needs to have public IP associated with it.</span></span>

2. <span data-ttu-id="014e8-360">La risoluzione dei nomi DNS che i servizi di Office 365 eseguono per risolvere gli endpoint locali avviene tramite DNS pubblico.</span><span class="sxs-lookup"><span data-stu-id="014e8-360">All DNS name resolution that Office 365 services perform to resolve on-premises endpoints happen using public DNS.</span></span> <span data-ttu-id="014e8-361">Questo significa che è necessario registrare i mapping FQDN degli endpoint dei servizi in ingresso in Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-361">This means that you must register inbound service endpoints' FQDN to IP mappings on the Internet.</span></span>

3. <span data-ttu-id="014e8-362">Per ricevere connessioni di rete in ingresso su ExpressRoute, le subnet IP pubbliche per tali endpoint devono essere pubblicizzate su Microsoft su ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-362">In order to receive inbound network connections over ExpressRoute, the public IP subnets for these endpoints must to be advertised to Microsoft over ExpressRoute.</span></span>

4. <span data-ttu-id="014e8-363">Valutare attentamente i flussi del traffico di rete in ingresso per garantire che vengano applicati ai controlli di rete e di sicurezza appropriati in base ai criteri di sicurezza e di rete dell'azienda.</span><span class="sxs-lookup"><span data-stu-id="014e8-363">Carefully evaluate these inbound network traffic flows to ensure that proper security and network controls are applied to them in accordance with your company security and network policies.</span></span>

5. <span data-ttu-id="014e8-364">Dopo che gli endpoint in ingresso locali sono stati annunciati a Microsoft su ExpressRoute, ExpressRoute diventerà effettivamente il percorso di routing preferito per tali endpoint per tutti i servizi Microsoft, tra cui Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-364">Once your on-premises inbound endpoints are advertised to Microsoft over ExpressRoute, ExpressRoute will effectively become the preferred routing path to those endpoints for all Microsoft services, including Office 365.</span></span> <span data-ttu-id="014e8-365">Questo significa che le subnet degli endpoint devono essere utilizzate solo per le comunicazioni con i servizi di Office 365 e nessun altro servizio sulla rete Microsoft.</span><span class="sxs-lookup"><span data-stu-id="014e8-365">This means that those endpoint subnets must only be used for communications with Office 365 services and no other services on the Microsoft network.</span></span> <span data-ttu-id="014e8-366">In caso contrario, la progettazione provocherà il routing asimmetrico, in cui le connessioni in ingresso da altri servizi Microsoft preferiscono instradare l'ingresso su ExpressRoute, mentre il percorso di ritorno utilizzerà Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-366">Otherwise, your design will cause asymmetric routing where inbound connections from other Microsoft services prefer to route inbound over ExpressRoute, while the return path will use the Internet.</span></span>

6. <span data-ttu-id="014e8-367">Nel caso in cui un circuito ExpressRoute o un percorso Meet-me sia inverso, è necessario assicurarsi che gli endpoint in ingresso locali siano ancora disponibili per accettare le richieste su un percorso di rete distinto.</span><span class="sxs-lookup"><span data-stu-id="014e8-367">In the event an ExpressRoute circuit or meet-me location is down, you'll need to ensure the on-premises inbound endpoints are still available to accept requests over a separate network path.</span></span> <span data-ttu-id="014e8-368">Ciò può significare subnet pubblicitarie per tali endpoint tramite più circuiti ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-368">This may mean advertising subnets for those endpoints through multiple ExpressRoute circuits.</span></span>

7. <span data-ttu-id="014e8-369">È consigliabile applicare NAT di origine per tutti i flussi del traffico di rete in ingresso che entrano nella rete tramite ExpressRoute, soprattutto quando questi flussi interessano i dispositivi di rete, ad esempio i firewall.</span><span class="sxs-lookup"><span data-stu-id="014e8-369">We recommend applying source NAT for all inbound network traffic flows entering your network through ExpressRoute, especially when these flows cross stateful network devices such as firewalls.</span></span>

8. <span data-ttu-id="014e8-370">Alcuni servizi locali, ad esempio il proxy ADFS o l'individuazione automatica di Exchange, possono ricevere richieste in ingresso da entrambi i servizi e gli utenti di Office 365 da Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-370">Some on-premises services, such as ADFS proxy or Exchange autodiscover, may receive inbound requests from both Office 365 services and users from the Internet.</span></span> <span data-ttu-id="014e8-371">Per queste richieste, Office 365 avrà lo stesso nome di dominio completo delle richieste degli utenti su Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-371">For these requests Office 365 will target the same FQDN as user requests over the Internet.</span></span> <span data-ttu-id="014e8-372">La possibilità di utilizzare ExpressRoute per le connessioni degli utenti in ingresso da Internet a quegli endpoint locali, mentre la forzatura delle connessioni di Office 365, rappresenta una significativa complessità del routing.</span><span class="sxs-lookup"><span data-stu-id="014e8-372">Allowing inbound user connections from the internet to those on-premises endpoints, while forcing Office 365 connections to use ExpressRoute, represents significant routing complexity.</span></span> <span data-ttu-id="014e8-373">Per la vasta maggioranza dei clienti che implementano scenari complessi su ExpressRoute non è consigliabile a causa di considerazioni operative.</span><span class="sxs-lookup"><span data-stu-id="014e8-373">For the vast majority of customers implementing such complex scenarios over ExpressRoute is not recommended due to operational considerations.</span></span> <span data-ttu-id="014e8-374">Questo sovraccarico aggiuntivo include, gestendo i rischi del routing asimmetrico e richiede la gestione accurata degli annunci e dei criteri di routing su più dimensioni.</span><span class="sxs-lookup"><span data-stu-id="014e8-374">This additional overhead includes, managing risks of asymmetric routing and will require you to carefully manage routing advertisements and policies across multiple dimensions.</span></span>

### <a name="update-your-network-topology-plan-to-show-how-you-would-avoid-asymmetric-routes"></a><span data-ttu-id="014e8-375">Aggiornare il piano di topologia di rete per mostrare come evitare le rotte asimmetriche</span><span class="sxs-lookup"><span data-stu-id="014e8-375">Update your network topology plan to show how you would avoid asymmetric routes</span></span>
<span data-ttu-id="014e8-376"><a name="asymmetric"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-376"></span></span>

<span data-ttu-id="014e8-377">Si desidera evitare il routing asimmetrico per garantire che gli utenti dell'organizzazione possano utilizzare senza problemi Office 365 e altri servizi importanti su Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-377">You want to avoid asymmetric routing to ensure people in your organization can seamlessly use Office 365 as well as other important services on the internet.</span></span> <span data-ttu-id="014e8-378">Sono disponibili due comuni configurazioni che causano il routing asimmetrico.</span><span class="sxs-lookup"><span data-stu-id="014e8-378">There are two common configurations customers have that cause asymmetric routing.</span></span> <span data-ttu-id="014e8-379">Ora è un buon momento per esaminare la configurazione di rete che si sta pianificando di utilizzare e verificare se uno di questi scenari di routing asimmetrico potrebbe esistere.</span><span class="sxs-lookup"><span data-stu-id="014e8-379">Now's a good time to review the network configuration you're planning to use and check if one of these asymmetric routing scenarios could exist.</span></span>
  
<span data-ttu-id="014e8-380">Per iniziare, verranno esaminate alcune situazioni diverse associate al diagramma di rete seguente.</span><span class="sxs-lookup"><span data-stu-id="014e8-380">To begin, we'll examine a few different situations associated with the following network diagram.</span></span> <span data-ttu-id="014e8-381">In questo diagramma, tutti i server che ricevono richieste in ingresso, ad esempio ADFS o server ibridi locali, si trovano nel data center del New Jersey e sono pubblicizzati su Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-381">In this diagram, all servers that receive inbound requests, such as ADFS or on-premises hybrid servers are in the New Jersey data center and are advertised to the internet.</span></span>
  
1. <span data-ttu-id="014e8-382">Anche se la rete perimetrale è sicura, non esiste alcuna NAT di origine disponibile per le richieste in arrivo.</span><span class="sxs-lookup"><span data-stu-id="014e8-382">While the perimeter network is secure, there is no Source NAT available for incoming requests.</span></span>

2. <span data-ttu-id="014e8-383">I server del Data Center di New Jersey sono in grado di visualizzare sia le route Internet che quelle di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-383">The servers in the New Jersey data center are able to see both internet and ExpressRoute routes.</span></span>

![Panoramica della connettività di ExpressRoute](media/8f074af6-ef38-44e8-bc5a-8b4d981fbb20.png)
  
<span data-ttu-id="014e8-385">Sono inoltre presenti suggerimenti su come correggerli.</span><span class="sxs-lookup"><span data-stu-id="014e8-385">We also have suggestions on how to fix them.</span></span>
  
#### <a name="problem-1-cloud-to-on-premises-connection-over-the-internet"></a><span data-ttu-id="014e8-386">Problema 1: cloud alla connessione locale tramite Internet</span><span class="sxs-lookup"><span data-stu-id="014e8-386">Problem 1: Cloud to on-premises connection over the Internet</span></span>
  
<span data-ttu-id="014e8-387">Nel diagramma seguente viene illustrato il percorso di rete asimmetrico eseguito quando la configurazione di rete non fornisce NAT per le richieste in ingresso da Microsoft Cloud su Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-387">The following diagram illustrates the asymmetric network path taken when your network configuration doesn't provide NAT for inbound requests from the Microsoft cloud over the internet.</span></span>
  
1. <span data-ttu-id="014e8-388">La richiesta in ingresso proveniente da Office 365 recupera l'indirizzo IP dell'endpoint locale da DNS pubblico e Invia la richiesta alla rete perimetrale.</span><span class="sxs-lookup"><span data-stu-id="014e8-388">The inbound request from Office 365 retrieves the IP address of the on-premises endpoint from public DNS and sends the request to your perimeter network.</span></span>

2. <span data-ttu-id="014e8-389">In questa configurazione difettosa non è presente alcun NAT di origine configurato o disponibile nella rete perimetrale in cui il traffico viene inviato con l'indirizzo IP di origine effettivo utilizzato come destinazione di ritorno.</span><span class="sxs-lookup"><span data-stu-id="014e8-389">In this faulty configuration, there is no Source NAT configured or available at the perimeter network where the traffic is sent resulting in the actual source IP address being used as the return destination.</span></span>

  - <span data-ttu-id="014e8-390">Il server della rete instrada il traffico di ritorno a Office 365 tramite una connessione di rete di ExpressRoute disponibile.</span><span class="sxs-lookup"><span data-stu-id="014e8-390">The server on your network routes the return traffic to Office 365 through any available ExpressRoute network connection.</span></span>

  - <span data-ttu-id="014e8-391">Il risultato è un percorso asimmetrico per il flusso a Office 365, causando una connessione interrotta.</span><span class="sxs-lookup"><span data-stu-id="014e8-391">The result is an Asymmetric path for that flow to Office 365, resulting in a broken connection.</span></span>

![ExpressRoute asimmetrica del routing problema 1](media/9c210c2a-e0ea-4180-8ede-1bf41746ce7a.png)
  
##### <a name="solution-1a-source-nat"></a><span data-ttu-id="014e8-393">Soluzione 1a: NAT di origine</span><span class="sxs-lookup"><span data-stu-id="014e8-393">Solution 1a: Source NAT</span></span>
  
<span data-ttu-id="014e8-394">La semplice aggiunta di un NAT di origine alla richiesta in ingresso risolve questa rete non configurata in modo non configurato.</span><span class="sxs-lookup"><span data-stu-id="014e8-394">Simply adding a source NAT to the inbound request resolves this misconfigured network.</span></span> <span data-ttu-id="014e8-395">In questo diagramma:</span><span class="sxs-lookup"><span data-stu-id="014e8-395">In this diagram:</span></span>
  
1. <span data-ttu-id="014e8-396">La richiesta in arrivo continua a essere introdotta attraverso la rete perimetrale del data center del New Jersey.</span><span class="sxs-lookup"><span data-stu-id="014e8-396">The incoming request continues to enter through the New Jersey data center's perimeter network.</span></span> <span data-ttu-id="014e8-397">Questa volta è disponibile NAT.</span><span class="sxs-lookup"><span data-stu-id="014e8-397">This time Source NAT is available.</span></span>

2. <span data-ttu-id="014e8-398">La risposta del server instrada verso l'IP associato al NAT di origine anziché all'indirizzo IP originale, causando la risposta che ritorna lungo lo stesso percorso di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-398">The response from the server routes back toward the IP associated with the Source NAT instead of the original IP address, resulting in the response returning along the same network path.</span></span>

![Soluzione di routing asimmetrica ExpressRoute 1](media/0e87a155-f8de-48ed-92ac-27367b727a82.png)
  
##### <a name="solution-1b-route-scoping"></a><span data-ttu-id="014e8-400">Soluzione 1B: instradare l'ambito</span><span class="sxs-lookup"><span data-stu-id="014e8-400">Solution 1b: Route Scoping</span></span>
  
<span data-ttu-id="014e8-401">In alternativa, è possibile scegliere di non consentire l'annuncio dei prefissi di ExpressRoute BGP, rimuovendo il percorso di rete alternativo per tali computer.</span><span class="sxs-lookup"><span data-stu-id="014e8-401">Alternatively, you can choose to not allow the ExpressRoute BGP prefixes to be advertised, removing the alternate network path for those computers.</span></span> <span data-ttu-id="014e8-402">In questo diagramma:</span><span class="sxs-lookup"><span data-stu-id="014e8-402">In this diagram:</span></span>
  
1. <span data-ttu-id="014e8-403">La richiesta in arrivo continua a essere introdotta attraverso la rete perimetrale del data center del New Jersey.</span><span class="sxs-lookup"><span data-stu-id="014e8-403">The incoming request continues to enter through the New Jersey data center's perimeter network.</span></span> <span data-ttu-id="014e8-404">Questa volta i prefissi annunciati da Microsoft sul circuito di ExpressRoute non sono disponibili per il Data Center del New Jersey.</span><span class="sxs-lookup"><span data-stu-id="014e8-404">This time the prefixes advertised from Microsoft over the ExpressRoute circuit are not available to the New Jersey data center.</span></span>

2. <span data-ttu-id="014e8-405">La risposta del server reindirizza verso l'IP associato all'indirizzo IP originale sull'unica route disponibile, causando la risposta che ritorna lungo lo stesso percorso di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-405">The response from the server routes back toward the IP associated with the original IP address over the only route available, resulting in the response returning along the same network path.</span></span>

![Soluzione di routing di ExpressRoute asimmetrica 2](media/9cb4b2bf-7aa6-487a-bc02-e02af8a979f6.png)
  
#### <a name="problem-2-cloud-to-on-premises-connection-over-expressroute"></a><span data-ttu-id="014e8-407">Problema 2: Cloud to on-premises connection over ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="014e8-407">Problem 2: Cloud to on-premises connection over ExpressRoute</span></span>
  
<span data-ttu-id="014e8-408">Nel diagramma seguente viene illustrato il percorso di rete asimmetrico eseguito quando la configurazione di rete non fornisce NAT per le richieste in ingresso da Microsoft Cloud su ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-408">The following diagram illustrates the asymmetric network path taken when your network configuration doesn't provide NAT for inbound requests from the Microsoft cloud over ExpressRoute.</span></span>
  
1. <span data-ttu-id="014e8-409">La richiesta in ingresso proveniente da Office 365 recupera l'indirizzo IP da DNS e Invia la richiesta alla rete perimetrale.</span><span class="sxs-lookup"><span data-stu-id="014e8-409">The inbound request from Office 365 retrieves the IP address from DNS and sends the request to your perimeter network.</span></span>

2. <span data-ttu-id="014e8-410">In questa configurazione difettosa non è presente alcun NAT di origine configurato o disponibile nella rete perimetrale in cui il traffico viene inviato con l'indirizzo IP di origine effettivo utilizzato come destinazione di ritorno.</span><span class="sxs-lookup"><span data-stu-id="014e8-410">In this faulty configuration, there is no Source NAT configured or available at the perimeter network where the traffic is sent resulting in the actual source IP address being used as the return destination.</span></span>

  - <span data-ttu-id="014e8-411">Il computer della rete instrada il traffico di ritorno a Office 365 tramite una connessione di rete di ExpressRoute disponibile.</span><span class="sxs-lookup"><span data-stu-id="014e8-411">The computer on your network routes the return traffic to Office 365 through any available ExpressRoute network connection.</span></span>

  - <span data-ttu-id="014e8-412">Il risultato è una connessione asimmetrica a Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-412">The result is an Asymmetric connection to Office 365.</span></span>

![ExpressRoute asimmetrica routing problem 2](media/f6fd155b-bbb7-472a-846e-039a99f09913.png)
  
##### <a name="solution-2-source-nat"></a><span data-ttu-id="014e8-414">Soluzione 2: NAT di origine</span><span class="sxs-lookup"><span data-stu-id="014e8-414">Solution 2: Source NAT</span></span>
  
<span data-ttu-id="014e8-415">La semplice aggiunta di un NAT di origine alla richiesta in ingresso risolve questa rete non configurata in modo non configurato.</span><span class="sxs-lookup"><span data-stu-id="014e8-415">Simply adding a source NAT to the inbound request resolves this misconfigured network.</span></span> <span data-ttu-id="014e8-416">In questo diagramma:</span><span class="sxs-lookup"><span data-stu-id="014e8-416">In this diagram:</span></span>
  
1. <span data-ttu-id="014e8-417">La richiesta in arrivo continua a essere introdotta attraverso la rete perimetrale di New York Data Center.</span><span class="sxs-lookup"><span data-stu-id="014e8-417">The incoming request continues to enter through the New York data center's perimeter network.</span></span> <span data-ttu-id="014e8-418">Questa volta è disponibile NAT.</span><span class="sxs-lookup"><span data-stu-id="014e8-418">This time Source NAT is available.</span></span>

2. <span data-ttu-id="014e8-419">La risposta del server instrada verso l'IP associato al NAT di origine anziché all'indirizzo IP originale, causando la risposta che ritorna lungo lo stesso percorso di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-419">The response from the server routes back toward the IP associated with the Source NAT instead of the original IP address, resulting in the response returning along the same network path.</span></span>

![Soluzione di routing ExpressRoute asimmetrica 3](media/a5d2b90d-a3ec-4047-afbf-6e6e99f376a7.png)
  
### <a name="paper-verify-that-the-network-design-has-path-symmetry"></a><span data-ttu-id="014e8-421">Documento verificare che la struttura di rete abbia una simmetria del percorso</span><span class="sxs-lookup"><span data-stu-id="014e8-421">Paper verify that the network design has path symmetry</span></span>

<span data-ttu-id="014e8-422">A questo punto, è necessario verificare su carta che il piano di implementazione offra la simmetria del percorso per i diversi scenari in cui si utilizzerà Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-422">At this point, you need to verify on paper that your implementation plan offers route symmetry for the different scenarios in which you'll be using Office 365.</span></span> <span data-ttu-id="014e8-423">È possibile identificare la route di rete specifica che dovrebbe essere eseguita quando una persona utilizza diverse funzionalità del servizio.</span><span class="sxs-lookup"><span data-stu-id="014e8-423">You'll identify the specific network route that is expected to be taken when a person uses different features of the service.</span></span> <span data-ttu-id="014e8-424">Dalla rete locale e il routing WAN, ai dispositivi perimetrali, al percorso di connettività; ExpressRoute o Internet e alla connessione all'endpoint online.</span><span class="sxs-lookup"><span data-stu-id="014e8-424">From the on-premises network and WAN routing, to the perimeter devices, to the connectivity path; ExpressRoute or the internet, and on to the connection to the online endpoint.</span></span>
  
<span data-ttu-id="014e8-425">Sarà necessario eseguire questa operazione per tutti i servizi di rete di Office 365 precedentemente identificati come servizi adottati dall'organizzazione.</span><span class="sxs-lookup"><span data-stu-id="014e8-425">You'll need to do this for all of the Office 365 network services that were previously identified as services that your organization will adopt.</span></span>
  
<span data-ttu-id="014e8-426">Questo foglio di lavoro consente di eseguire questa operazione tramite percorsi con una seconda persona.</span><span class="sxs-lookup"><span data-stu-id="014e8-426">It helps to do this paper walk through of routes with a second person.</span></span> <span data-ttu-id="014e8-427">Spiegare loro dove ogni hop di rete dovrebbe ottenere la successiva route e assicurarsi di avere familiarità con i percorsi di routing.</span><span class="sxs-lookup"><span data-stu-id="014e8-427">Explain to them where each network hop is expected to get its next route from and ensure that you're familiar with the routing paths.</span></span> <span data-ttu-id="014e8-428">Tenere presente che ExpressRoute fornirà sempre una route con più ambiti agli indirizzi IP dei server Microsoft assegnando un costo del percorso più basso rispetto a una route predefinita Internet.</span><span class="sxs-lookup"><span data-stu-id="014e8-428">Remember that ExpressRoute will always provide a more scoped route to Microsoft server IP addresses giving it lower route cost than an Internet default route.</span></span>
  
### <a name="design-client-connectivity-configuration"></a><span data-ttu-id="014e8-429">Progettare la configurazione della connettività client</span><span class="sxs-lookup"><span data-stu-id="014e8-429">Design Client Connectivity Configuration</span></span>
<span data-ttu-id="014e8-430"><a name="asymmetric"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-430"></span></span>

![Utilizzo dei file PAC con ExpressRoute](media/7cfa6482-dbae-416a-ae6f-a45e5f4de23b.png)
  
<span data-ttu-id="014e8-432">Se si utilizza un server proxy per il traffico Internet associato, è necessario modificare i file di configurazione del client o PAC per garantire che i computer client della rete siano configurati correttamente per inviare il traffico ExpressRoute desiderato a Office 365 senza transitare il server proxy e il traffico restante, incluso il traffico di Office 365, vengono inviati al proxy pertinente.</span><span class="sxs-lookup"><span data-stu-id="014e8-432">If you're using a proxy server for internet bound traffic then you need to adjust any PAC or client configuration files to ensure client computers on your network are correctly configured to send the ExpressRoute traffic you desire to Office 365 without transiting your proxy server, and the remaining traffic, including some Office 365 traffic, is sent to the relevant proxy.</span></span> <span data-ttu-id="014e8-433">Leggere la guida sulla [gestione degli endpoint di Office 365](https://aka.ms/manageo365endpoints) , ad esempio i file PAC.</span><span class="sxs-lookup"><span data-stu-id="014e8-433">Read our guide on [managing Office 365 endpoints](https://aka.ms/manageo365endpoints) for example PAC files.</span></span>
  
> [!NOTE]
> <span data-ttu-id="014e8-434">Gli endpoint cambiano spesso, tutte le volte che sono settimanalmente.</span><span class="sxs-lookup"><span data-stu-id="014e8-434">The endpoints change frequently, as often as weekly.</span></span> <span data-ttu-id="014e8-435">È consigliabile apportare modifiche solo in base ai servizi e alle caratteristiche che l'organizzazione ha adottato per ridurre il numero di modifiche che è necessario apportare per rimanere aggiornate.</span><span class="sxs-lookup"><span data-stu-id="014e8-435">You should only make changes based on the services and features your organization has adopted to reduce the number of changes you'll need to make to stay current.</span></span> <span data-ttu-id="014e8-436">Prestare particolare attenzione alla **Data di validità** del feed RSS in cui vengono annunciate le modifiche e viene mantenuto un record di tutte le modifiche passate, gli indirizzi IP annunciati non possono essere pubblicizzati o rimossi dall'annuncio, finché non viene raggiunta la data effettiva.</span><span class="sxs-lookup"><span data-stu-id="014e8-436">Pay close attention to the **Effective Date** in the RSS feed where the changes are announced and a record is kept of all past changes, IP addresses that are announced may not be advertised, or removed from advertisement, until the effective date is reached.</span></span>
  
## <a name="build-your-deployment-and-testing-procedures"></a><span data-ttu-id="014e8-437">Creare le procedure di distribuzione e testing</span><span class="sxs-lookup"><span data-stu-id="014e8-437">Build your deployment and testing procedures</span></span>
<span data-ttu-id="014e8-438"><a name="testing"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-438"></span></span>

<span data-ttu-id="014e8-439">Il piano di implementazione deve includere sia la pianificazione del testing sia quella di rollback.</span><span class="sxs-lookup"><span data-stu-id="014e8-439">Your implementation plan should include both testing and rollback planning.</span></span> <span data-ttu-id="014e8-440">Se l'implementazione non funziona come previsto, il piano dovrebbe essere progettato in modo da influenzare il minor numero di persone prima che vengano scoperti i problemi.</span><span class="sxs-lookup"><span data-stu-id="014e8-440">If your implementation isn't functioning as expected, the plan should be designed to affect the least number of people before problems are discovered.</span></span> <span data-ttu-id="014e8-441">Di seguito sono riportati alcuni principi di alto livello che il piano dovrebbe prendere in considerazione.</span><span class="sxs-lookup"><span data-stu-id="014e8-441">The following are some high level principles your plan should consider.</span></span>
  
1. <span data-ttu-id="014e8-442">Eseguire la fase di onboarding del segmento di rete e del servizio utente per ridurre al minimo le interruzioni.</span><span class="sxs-lookup"><span data-stu-id="014e8-442">Stage the network segment and user service onboarding to minimize disruption.</span></span>

2. <span data-ttu-id="014e8-443">Pianificare il testing delle route con traceroute e TCP Connect da un host connesso a Internet separato.</span><span class="sxs-lookup"><span data-stu-id="014e8-443">Plan for testing routes with traceroute and TCP connect from a separate internet connected host.</span></span>

3. <span data-ttu-id="014e8-444">Preferibilmente, il testing dei servizi in ingresso e in uscita dovrebbe essere effettuato su una rete di test isolata con un tenant di test Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-444">Preferably, testing of inbound and outbound services should be done on an isolated test network with a test Office 365 tenant.</span></span>

      - <span data-ttu-id="014e8-445">In alternativa, il test può essere eseguito su una rete di produzione se il cliente non utilizza ancora Office 365 o è in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="014e8-445">Alternatively, testing can be performed on a production network if the customer is not yet using Office 365 or is in pilot.</span></span>

      - <span data-ttu-id="014e8-446">In alternativa, il test può essere eseguito durante un'interruzione di produzione accantonata solo per il testing e il monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="014e8-446">Alternatively, testing can be performed during a production outage that is set aside for test and monitoring only.</span></span>

      - <span data-ttu-id="014e8-447">In alternativa, il test può essere effettuato controllando le route per ogni servizio su ogni nodo del router Layer 3.</span><span class="sxs-lookup"><span data-stu-id="014e8-447">Alternatively, testing can be done by checking routes for each service on each layer 3 router node.</span></span> <span data-ttu-id="014e8-448">Questo rientro dovrebbe essere utilizzato solo se non è possibile eseguire altri test poiché la mancanza di test fisici introduce un rischio.</span><span class="sxs-lookup"><span data-stu-id="014e8-448">This fall back should only be used if no other testing is possible since a lack of physical testing introduces risk.</span></span>

### <a name="build-your-deployment-procedures"></a><span data-ttu-id="014e8-449">Creare le procedure di distribuzione</span><span class="sxs-lookup"><span data-stu-id="014e8-449">Build your deployment procedures</span></span>

<span data-ttu-id="014e8-450">Le procedure di distribuzione devono essere distribuite a piccoli gruppi di persone in fasi che consentono di eseguire il test prima di eseguire la distribuzione in gruppi di persone di dimensioni maggiori.</span><span class="sxs-lookup"><span data-stu-id="014e8-450">Your deployment procedures should roll out to small groups of people in stages to allow for testing before deploying to larger groups of people.</span></span> <span data-ttu-id="014e8-451">Di seguito sono riportati alcuni modi per eseguire la distribuzione di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-451">The following are several ways to stage the deployment of ExpressRoute.</span></span>
  
1. <span data-ttu-id="014e8-452">Configurare ExpressRoute con Microsoft peering e fare in modo che gli annunci di route vengano inoltrati a un singolo host solo per scopi di test a fasi.</span><span class="sxs-lookup"><span data-stu-id="014e8-452">Set up ExpressRoute with Microsoft peering and have the route advertisements forwarded to a single host only for staged testing purposes.</span></span>

2. <span data-ttu-id="014e8-453">Pubblicizzare gli itinerari verso la rete ExpressRoute in un singolo segmento di rete e quindi espandere gli annunci instradati dal segmento di rete o dall'area geografica.</span><span class="sxs-lookup"><span data-stu-id="014e8-453">Advertise routes to the ExpressRoute network to a single network segment at first and expand route advertisements by network segment or region.</span></span>

3. <span data-ttu-id="014e8-454">Se si distribuisce Office 365 per la prima volta, utilizzare la distribuzione di rete di ExpressRoute come pilota per un numero limitato di utenti.</span><span class="sxs-lookup"><span data-stu-id="014e8-454">If deploying Office 365 for the first time, use the ExpressRoute network deployment as a pilot for a small number of people.</span></span>

4. <span data-ttu-id="014e8-455">Se si utilizzano i server proxy, è possibile configurare in alternativa un file PAC di test per indirizzare un numero limitato di utenti a ExpressRoute con test e commenti e suggerimenti prima di aggiungerne altri.</span><span class="sxs-lookup"><span data-stu-id="014e8-455">If using proxy servers, you can alternatively configure a test PAC file to direct a small number of people to ExpressRoute with testing and feedback before adding more.</span></span>

<span data-ttu-id="014e8-456">Il piano di implementazione deve elencare tutte le procedure di distribuzione che devono essere eseguite o i comandi che devono essere utilizzati per distribuire la configurazione di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-456">Your implementation plan should list each of the deployment procedures that must be taken or commands that need to be used to deploy the networking configuration.</span></span> <span data-ttu-id="014e8-457">Quando il tempo di interruzione della rete arriva tutte le modifiche apportate deve provenire dal piano di distribuzione scritto che è stato scritto in anticipo e peer reviewed.</span><span class="sxs-lookup"><span data-stu-id="014e8-457">When the network outage time arrives all of the changes being made should be from the written deployment plan which was written in advance and peer reviewed.</span></span> <span data-ttu-id="014e8-458">Consultare le indicazioni sulla configurazione tecnica di ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-458">See our guidance on the technical configuration of ExpressRoute.</span></span>
  
- <span data-ttu-id="014e8-459">Aggiornamento dei record TXT SPF se sono stati modificati gli indirizzi IP di tutti i server locali che continueranno a inviare messaggi di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="014e8-459">Updating your SPF TXT records if you've changed IP addresses for any on-premises servers that will continue to send email.</span></span>

- <span data-ttu-id="014e8-460">Aggiornamento di tutte le voci DNS per i server locali se sono stati modificati gli indirizzi IP per ospitare una nuova configurazione NAT.</span><span class="sxs-lookup"><span data-stu-id="014e8-460">Updating any DNS entries for on-premises servers if you've changed IP addresses to accommodate a new NAT configuration.</span></span>

- <span data-ttu-id="014e8-461">Assicurarsi di aver sottoscritto il feed RSS per le notifiche degli endpoint di Office 365 per gestire le configurazioni di routing o proxy.</span><span class="sxs-lookup"><span data-stu-id="014e8-461">Ensure you've subscribed to the RSS feed for Office 365 endpoint notifications to maintain any routing or proxy configurations.</span></span>

<span data-ttu-id="014e8-462">Dopo aver completato la distribuzione di ExpressRoute, è necessario eseguire le procedure del piano di test.</span><span class="sxs-lookup"><span data-stu-id="014e8-462">After your ExpressRoute deployment is complete the procedures in the test plan should be executed.</span></span> <span data-ttu-id="014e8-463">I risultati di ogni procedura devono essere registrati.</span><span class="sxs-lookup"><span data-stu-id="014e8-463">Results for each procedure should be logged.</span></span> <span data-ttu-id="014e8-464">È necessario includere le procedure per eseguire il rollback all'ambiente di produzione originale nel caso in cui i risultati del piano di test indichino che l'implementazione non ha avuto esito positivo.</span><span class="sxs-lookup"><span data-stu-id="014e8-464">You must include procedures for rolling back to the original production environment in the event the test plan results indicate the implementation was not successful.</span></span>
  
### <a name="build-your-test-procedures"></a><span data-ttu-id="014e8-465">Creare le procedure di test</span><span class="sxs-lookup"><span data-stu-id="014e8-465">Build your test procedures</span></span>

<span data-ttu-id="014e8-466">Le procedure di testing devono includere i test per ogni servizio di rete in uscita e in ingresso per Office 365 entrambi che utilizzeranno ExpressRoute e quelli che non lo saranno.</span><span class="sxs-lookup"><span data-stu-id="014e8-466">Your testing procedures should include tests for each outbound and inbound network service for Office 365 both that will be using ExpressRoute and ones that will not.</span></span> <span data-ttu-id="014e8-467">Le procedure devono includere il testing da ogni percorso di rete univoco, compresi gli utenti non locali nella LAN aziendale.</span><span class="sxs-lookup"><span data-stu-id="014e8-467">The procedures should include testing from each unique network location including users who are not on-premises in the corporate LAN.</span></span>
  
<span data-ttu-id="014e8-468">Di seguito sono riportati alcuni esempi di attività di test.</span><span class="sxs-lookup"><span data-stu-id="014e8-468">Some examples of test activities include the following.</span></span>
  
1. <span data-ttu-id="014e8-469">Eseguire il ping dal router locale al router dell'operatore di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-469">Ping from your on-premises router to your network operator router.</span></span>

2. <span data-ttu-id="014e8-470">Convalidare gli annunci di indirizzi IP di 500 + Office 365 e CRM Online vengono ricevuti dal router locale.</span><span class="sxs-lookup"><span data-stu-id="014e8-470">Validate the 500+ Office 365 and CRM Online IP address advertisements are received by your on-premises router.</span></span>

3. <span data-ttu-id="014e8-471">Convalidare il NAT in ingresso e in uscita è in funzione tra ExpressRoute e la rete interna.</span><span class="sxs-lookup"><span data-stu-id="014e8-471">Validate your inbound and outbound NAT is operating between ExpressRoute and the internal network.</span></span>

4. <span data-ttu-id="014e8-472">Verificare che le route verso il NAT vengano pubblicizzate dal router.</span><span class="sxs-lookup"><span data-stu-id="014e8-472">Validate that routes to your NAT are being advertised from your router.</span></span>

5. <span data-ttu-id="014e8-473">Verificare che ExpressRoute abbia accettato i prefissi annunciati.</span><span class="sxs-lookup"><span data-stu-id="014e8-473">Validate that ExpressRoute has accepted your advertised prefixes.</span></span>

      - <span data-ttu-id="014e8-474">Utilizzare il seguente cmdlet per verificare la presenza di annunci peering:</span><span class="sxs-lookup"><span data-stu-id="014e8-474">Use the following cmdlet to verify peering advertisements:</span></span>

      ```PowerShell
      Get-AzureRmExpressRouteCircuitRouteTable -DevicePath Primary -ExpressRouteCircuitName TestER -ResourceGroupName RG -PeeringType MicrosoftPeering
      ```

6. <span data-ttu-id="014e8-475">Convalidare l'intervallo IP pubblico NAT non è pubblicizzato a Microsoft tramite altri ExpressRoute o circuiti di rete Internet pubblici, a meno che non si tratta di un sottoinsieme specifico di un intervallo più esteso come nell'esempio precedente.</span><span class="sxs-lookup"><span data-stu-id="014e8-475">Validate your public NAT IP range is not advertised to Microsoft through any other ExpressRoute or public Internet network circuit unless it is a specific subset of a larger range as in the previous example.</span></span>

7. <span data-ttu-id="014e8-476">I circuiti di ExpressRoute sono associati, convalidare che entrambe le sessioni BGP sono in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="014e8-476">ExpressRoute circuits are paired, validate that both BGP sessions are running.</span></span>

8. <span data-ttu-id="014e8-477">Configurare un singolo host all'interno del NAT e utilizzare ping, tracert e tcpping per testare la connettività tra il nuovo circuito e l'host outlook.office365.com.</span><span class="sxs-lookup"><span data-stu-id="014e8-477">Set up a single host on the inside of your NAT and use ping, tracert, and tcpping to test connectivity across the new circuit to the host outlook.office365.com.</span></span> <span data-ttu-id="014e8-478">In alternativa, è possibile utilizzare uno strumento come Wireshark o Microsoft Network Monitor 3,4 su una porta con mirroring per MSEE per convalidare la possibilità di connettersi all'indirizzo IP associato a outlook.office365.com.</span><span class="sxs-lookup"><span data-stu-id="014e8-478">Alternatively, you could use a tool such as Wireshark or Microsoft Network Monitor 3.4 on a mirrored port to the MSEE to validate you're able to connect to the IP address associated with outlook.office365.com.</span></span>

9. <span data-ttu-id="014e8-479">Testare le funzionalità a livello di applicazione per Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="014e8-479">Test application level functionality for Exchange Online.</span></span>

  - <span data-ttu-id="014e8-480">Test Outlook è in grado di connettersi a Exchange Online e inviare/ricevere messaggi di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="014e8-480">Test Outlook is able to connect to Exchange Online and send/receive email.</span></span>

  - <span data-ttu-id="014e8-481">Test Outlook è in grado di utilizzare la modalità online.</span><span class="sxs-lookup"><span data-stu-id="014e8-481">Test Outlook is able to use online-mode.</span></span>

  - <span data-ttu-id="014e8-482">Testare la connettività di smartphone e la funzionalità di invio/ricezione.</span><span class="sxs-lookup"><span data-stu-id="014e8-482">Test smartphone connectivity and send/receive capability.</span></span>

10. <span data-ttu-id="014e8-483">Testare le funzionalità a livello di applicazione per SharePoint Online</span><span class="sxs-lookup"><span data-stu-id="014e8-483">Test application level functionality for SharePoint Online</span></span>

  - <span data-ttu-id="014e8-484">Testare il client di sincronizzazione di OneDrive for business.</span><span class="sxs-lookup"><span data-stu-id="014e8-484">Test OneDrive for Business sync client.</span></span>

  - <span data-ttu-id="014e8-485">Test di SharePoint Online Web Access.</span><span class="sxs-lookup"><span data-stu-id="014e8-485">Test SharePoint Online web access.</span></span>

11. <span data-ttu-id="014e8-486">Testare le funzionalità a livello di applicazione per gli scenari di chiamata di Skype for business:</span><span class="sxs-lookup"><span data-stu-id="014e8-486">Test application level functionality for Skype for Business calling scenarios:</span></span>

  - <span data-ttu-id="014e8-487">Join to Conference Call As Authenticated user [invite iniziato dall'utente finale].</span><span class="sxs-lookup"><span data-stu-id="014e8-487">Join to conference call as authenticated user [invite initiated by end user].</span></span>

  - <span data-ttu-id="014e8-488">Invitare un utente a una chiamata in conferenza [invito inviato da MCU].</span><span class="sxs-lookup"><span data-stu-id="014e8-488">Invite user to conference call [invite sent from MCU].</span></span>

  - <span data-ttu-id="014e8-489">Partecipare a una conferenza come utente anonimo utilizzando l'applicazione web Skype for business.</span><span class="sxs-lookup"><span data-stu-id="014e8-489">Join conference as anonymous user using the Skype for Business web application.</span></span>

  - <span data-ttu-id="014e8-490">Chiamata di join dalla connessione del PC cablata, dal telefono IP e dal dispositivo mobile.</span><span class="sxs-lookup"><span data-stu-id="014e8-490">Join call from your wired PC connection, IP phone, and mobile device.</span></span>

  - <span data-ttu-id="014e8-491">Chiamata a un utente federato o a una chiamata alla convalida PSTN: la chiamata è stata completata, la qualità delle chiamate è accettabile, il tempo di connessione è accettabile.</span><span class="sxs-lookup"><span data-stu-id="014e8-491">Call to federated user o Call to PSTN Validation: call is completed, call quality is acceptable, connection time is acceptable.</span></span>

  - <span data-ttu-id="014e8-492">Verificare che lo stato di presenza dei contatti venga aggiornato per entrambi i membri del tenant e degli utenti federati.</span><span class="sxs-lookup"><span data-stu-id="014e8-492">Verify presence status for contacts is updated for both members of the tenant and federated users.</span></span>

### <a name="common-problems"></a><span data-ttu-id="014e8-493">Problemi comuni</span><span class="sxs-lookup"><span data-stu-id="014e8-493">Common problems</span></span>

<span data-ttu-id="014e8-494">Il routing asimmetrico è il problema di implementazione più comune.</span><span class="sxs-lookup"><span data-stu-id="014e8-494">Asymmetric routing is the most common implementation problem.</span></span> <span data-ttu-id="014e8-495">Di seguito sono riportate alcune fonti comuni da cercare:</span><span class="sxs-lookup"><span data-stu-id="014e8-495">Here are some common sources to look for:</span></span>
  
- <span data-ttu-id="014e8-496">Utilizzo di una topologia di routing di rete aperta o piana senza NAT di origine sul posto.</span><span class="sxs-lookup"><span data-stu-id="014e8-496">Using an open or flat network routing topology without source NAT in place.</span></span>

- <span data-ttu-id="014e8-497">L'utilizzo di SNAT non viene utilizzato per instradare i servizi in ingresso tramite le connessioni Internet e ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-497">Not using SNAT to route to inbound services through both the internet and ExpressRoute connections.</span></span>

- <span data-ttu-id="014e8-498">Non è possibile testare i servizi in ingresso su ExpressRoute in una rete di test prima di distribuirli in generale.</span><span class="sxs-lookup"><span data-stu-id="014e8-498">Not testing inbound services on ExpressRoute on a test network prior to deploying broadly.</span></span>

## <a name="deploying-expressroute-connectivity-through-your-network"></a><span data-ttu-id="014e8-499">Distribuzione della connettività di ExpressRoute tramite la rete</span><span class="sxs-lookup"><span data-stu-id="014e8-499">Deploying ExpressRoute connectivity through your network</span></span>
<span data-ttu-id="014e8-500"><a name="testing"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-500"></span></span>

<span data-ttu-id="014e8-501">Eseguire il passaggio della distribuzione a un segmento della rete alla volta, distribuendo progressivamente la connettività a diverse parti della rete con un piano per eseguire il rollback per ogni nuovo segmento di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-501">Stage your deployment to one segment of the network at a time, progressively rolling out the connectivity to different parts of the network with a plan to roll back for each new network segment.</span></span> <span data-ttu-id="014e8-502">Se la distribuzione è allineata a una distribuzione di Office 365, distribuire prima gli utenti pilota di Office 365 ed estenderli da qui.</span><span class="sxs-lookup"><span data-stu-id="014e8-502">If your deployment is aligned with an Office 365 deployment, deploy to your Office 365 pilot users first and extend from there.</span></span>
  
<span data-ttu-id="014e8-503">In primo luogo per il test e quindi per la produzione:</span><span class="sxs-lookup"><span data-stu-id="014e8-503">First for your test and then for production:</span></span>
  
- <span data-ttu-id="014e8-504">Eseguire la procedura di distribuzione per abilitare ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="014e8-504">Run the deployment steps to enable ExpressRoute.</span></span>

- <span data-ttu-id="014e8-505">Verificare la visualizzazione delle route di rete come previsto.</span><span class="sxs-lookup"><span data-stu-id="014e8-505">Test your seeing the network routes are as expected.</span></span>

- <span data-ttu-id="014e8-506">Eseguire il testing su ogni servizio in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="014e8-506">Perform testing on each inbound and outbound service.</span></span>

- <span data-ttu-id="014e8-507">Rollback se si riscontrano problemi.</span><span class="sxs-lookup"><span data-stu-id="014e8-507">Rollback if you discover any issues.</span></span>

### <a name="set-up-a-test-connection-to-expressroute-with-a-test-network-segment"></a><span data-ttu-id="014e8-508">Configurare una connessione di test a ExpressRoute con un segmento di rete di test</span><span class="sxs-lookup"><span data-stu-id="014e8-508">Set up a test connection to ExpressRoute with a test network segment</span></span>

<span data-ttu-id="014e8-509">Dopo aver completato il piano su carta, è necessario eseguire il test su scala ridotta.</span><span class="sxs-lookup"><span data-stu-id="014e8-509">Now that you have the completed plan on paper it is time to test at a small scale.</span></span> <span data-ttu-id="014e8-510">In questo test si stabilirà una singola connessione di ExpressRoute con Microsoft peering a una subnet di prova sulla rete locale.</span><span class="sxs-lookup"><span data-stu-id="014e8-510">In this test you will establish a single ExpressRoute connection with Microsoft Peering to a test subnet on your on-premises network.</span></span> <span data-ttu-id="014e8-511">È possibile configurare una [versione di valutazione di Office 365 tenant](https://go.microsoft.com/fwlink/p/?LinkID=403802) con connettività da e verso la subnet dei test e includere tutti i servizi in uscita e in ingresso che verranno utilizzati per la produzione nella subnet di test.</span><span class="sxs-lookup"><span data-stu-id="014e8-511">You can configure a [trial Office 365 tenant](https://go.microsoft.com/fwlink/p/?LinkID=403802) with connectivity to and from the test subnet and include all outbound and inbound services that you will be using in production in the test subnet.</span></span> <span data-ttu-id="014e8-512">Configurare il DNS per il segmento di rete di test e stabilire tutti i servizi in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="014e8-512">Set up DNS for the test network segment and establish all inbound and outbound services.</span></span> <span data-ttu-id="014e8-513">Eseguire il piano di test e assicurarsi di avere familiarità con il routing per ogni servizio e la propagazione della route.</span><span class="sxs-lookup"><span data-stu-id="014e8-513">Execute your test plan and ensure that you are familiar with the routing for each service and the route propagation.</span></span>
  
### <a name="execute-the-deployment-and-test-plans"></a><span data-ttu-id="014e8-514">Eseguire i piani di distribuzione e di testing</span><span class="sxs-lookup"><span data-stu-id="014e8-514">Execute the deployment and test plans</span></span>

<span data-ttu-id="014e8-515">Dopo aver completato gli elementi descritti in precedenza, è necessario controllare le aree che sono state completate e verificare che l'utente e il team siano stati esaminati prima di eseguire i piani di distribuzione e testing.</span><span class="sxs-lookup"><span data-stu-id="014e8-515">As you complete the items described above, check off the areas you've completed and ensure you and your team have reviewed them before executing your deployment and testing plans.</span></span>
  
- <span data-ttu-id="014e8-516">Elenco dei servizi in uscita e in ingresso coinvolti nella modifica della rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-516">List of outbound and inbound services that are involved in the network change.</span></span>

- <span data-ttu-id="014e8-517">Diagramma dell'architettura di rete globale che mostra sia l'uscita Internet sia le posizioni ExpressRoute Meet-me.</span><span class="sxs-lookup"><span data-stu-id="014e8-517">Global network architecture diagram showing both internet egress and ExpressRoute meet-me locations.</span></span>

- <span data-ttu-id="014e8-518">Diagramma di distribuzione di rete in cui vengono illustrati i diversi percorsi di rete utilizzati per ogni servizio distribuito.</span><span class="sxs-lookup"><span data-stu-id="014e8-518">Network routing diagram demonstrating the different network paths used for each service deployed.</span></span>

- <span data-ttu-id="014e8-519">Piano di distribuzione con passaggi per implementare le modifiche e il rollback, se necessario.</span><span class="sxs-lookup"><span data-stu-id="014e8-519">A deployment plan with steps to implement the changes and rollback if needed.</span></span>

- <span data-ttu-id="014e8-520">Piano di testing per testare ogni Office 365 e il servizio di rete.</span><span class="sxs-lookup"><span data-stu-id="014e8-520">A test plan for testing each Office 365 and network service.</span></span>

- <span data-ttu-id="014e8-521">Convalida cartacea completata delle route di produzione per i servizi in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="014e8-521">Completed paper validation of production routes for inbound and outbound services.</span></span>

- <span data-ttu-id="014e8-522">Un test completato su un segmento di rete di test, inclusi i test di disponibilità.</span><span class="sxs-lookup"><span data-stu-id="014e8-522">A completed test across a test network segment including availability testing.</span></span>

<span data-ttu-id="014e8-523">Scegliere una finestra di interruzione che sia sufficiente per l'esecuzione dell'intero piano di distribuzione e del piano di testing, che sia disponibile un certo tempo per la risoluzione dei problemi e per il rollback, se necessario.</span><span class="sxs-lookup"><span data-stu-id="014e8-523">Choose an outage window that is long enough to run through the entire deployment plan and the test plan, has some time available for troubleshooting and time for rolling back if required.</span></span>
  
> [!CAUTION]
> <span data-ttu-id="014e8-524">A causa della natura complessa del routing su Internet e ExpressRoute, è consigliabile aggiungere ulteriore tempo di buffer alla finestra per gestire la risoluzione dei problemi relativi al routing complesso.</span><span class="sxs-lookup"><span data-stu-id="014e8-524">Due to the complex nature of routing over both the internet and ExpressRoute, it is recommended that additional buffer time is added to this window to handle troubleshooting complex routing.</span></span>
  
### <a name="configure-qos-for-skype-for-business-online"></a><span data-ttu-id="014e8-525">Configurare QoS per Skype for business online</span><span class="sxs-lookup"><span data-stu-id="014e8-525">Configure QoS for Skype for Business Online</span></span>

<span data-ttu-id="014e8-526">La funzionalità QoS è necessaria per ottenere vantaggi per la riunione e la voce per Skype for business online.</span><span class="sxs-lookup"><span data-stu-id="014e8-526">QoS is necessary to obtain voice and meeting benefits for Skype for Business Online.</span></span> <span data-ttu-id="014e8-527">È possibile configurare QoS dopo aver garantito che la connessione di rete di ExpressRoute non blocchi gli altri accessi al servizio di Office 365.</span><span class="sxs-lookup"><span data-stu-id="014e8-527">You can configure QoS after you have ensured that the ExpressRoute network connection does not block any of your other Office 365 service access.</span></span> <span data-ttu-id="014e8-528">La configurazione per QoS è descritta nell'articolo [ExpressRoute e QoS in Skype for business online](https://support.office.com/article/ExpressRoute-and-QoS-in-Skype-for-Business-Online-20c654da-30ee-4e4f-a764-8b7d8844431d) .</span><span class="sxs-lookup"><span data-stu-id="014e8-528">Configuration for QoS is described in the article [ExpressRoute and QoS in Skype for Business Online](https://support.office.com/article/ExpressRoute-and-QoS-in-Skype-for-Business-Online-20c654da-30ee-4e4f-a764-8b7d8844431d) .</span></span>
  
## <a name="troubleshooting-your-implementation"></a><span data-ttu-id="014e8-529">Risoluzione dei problemi relativi all'implementazione</span><span class="sxs-lookup"><span data-stu-id="014e8-529">Troubleshooting your implementation</span></span>
<span data-ttu-id="014e8-530"><a name="troubleshooting"> </a></span><span class="sxs-lookup"><span data-stu-id="014e8-530"></span></span>

<span data-ttu-id="014e8-531">La prima cosa da vedere è la procedura descritta in questa guida all'implementazione, sono state perse nel piano di implementazione?</span><span class="sxs-lookup"><span data-stu-id="014e8-531">The first place to look is at the steps in this implementation guide, were any missed in your implementation plan?</span></span> <span data-ttu-id="014e8-532">Se possibile, è necessario eseguire ulteriori test di rete di piccole dimensioni per replicare l'errore e eseguirne il debug.</span><span class="sxs-lookup"><span data-stu-id="014e8-532">Go back and run further small network testing if possible to replicate the error and debug it there.</span></span>
  
<span data-ttu-id="014e8-533">Identificare i servizi in ingresso o in uscita non riusciti durante il testing.</span><span class="sxs-lookup"><span data-stu-id="014e8-533">Identify which inbound or outbound services failed during testing.</span></span> <span data-ttu-id="014e8-534">Ottenere in modo specifico gli indirizzi IP e le subnet per ognuno dei servizi che hanno avuto esito negativo.</span><span class="sxs-lookup"><span data-stu-id="014e8-534">Get specifically the IP addresses and subnets for each of the services which failed.</span></span> <span data-ttu-id="014e8-535">Andare avanti e percorrere il diagramma della topologia di rete su carta e convalidare il routing.</span><span class="sxs-lookup"><span data-stu-id="014e8-535">Go ahead and walk the network topology diagram on paper and validate the routing.</span></span> <span data-ttu-id="014e8-536">Convalidare in modo specifico il percorso in cui viene pubblicizzato il routing di ExpressRoute, verificare che il routing durante l'interruzione, se possibile con le tracce.</span><span class="sxs-lookup"><span data-stu-id="014e8-536">Validate specifically where the ExpressRoute routing is advertised to, Test that routing during the outage if possible with traces.</span></span>
  
<span data-ttu-id="014e8-537">Eseguire PSPing con una traccia di rete per ogni endpoint del cliente e valutare gli indirizzi IP di origine e di destinazione per convalidare i risultati previsti.</span><span class="sxs-lookup"><span data-stu-id="014e8-537">Run PSPing with a network trace to each customer endpoint and evaluate source and destination IP addresses to validate that they are as expected.</span></span> <span data-ttu-id="014e8-538">Eseguire Telnet a qualsiasi host di posta elettronica esposto sulla porta 25 e verificare che SNAT nasconda l'indirizzo IP di origine originale, se previsto.</span><span class="sxs-lookup"><span data-stu-id="014e8-538">Run telnet to any mail host that you expose on port 25 and verify that SNAT is hiding the original source IP address if this is expected.</span></span>
  
<span data-ttu-id="014e8-539">Tenere presente che, durante la distribuzione di Office 365 con una connessione ExpressRoute, è necessario assicurarsi che sia la configurazione di rete per ExpressRoute sia stata progettata in modo ottimale e che siano stati ottimizzati anche gli altri componenti della rete, ad esempio i computer client.</span><span class="sxs-lookup"><span data-stu-id="014e8-539">Keep in mind that while deploying Office 365 with an ExpressRoute connection you'll need to ensure both the network configuration for ExpressRoute is optimally designed and you've also optimized the other components on your network such as client computers.</span></span> <span data-ttu-id="014e8-540">Oltre a utilizzare questa guida alla pianificazione per la risoluzione dei problemi che potrebbero essere stati persi, è stato anche scritto un [piano per la risoluzione dei problemi relativi alle prestazioni per Office 365](https://support.office.com/article/Performance-troubleshooting-plan-for-Office-365-e241e5d9-b1d8-4f1d-a5c8-4106b7325f8c) .</span><span class="sxs-lookup"><span data-stu-id="014e8-540">In addition to using this planning guide to troubleshoot the steps you may have missed, we also have written a [Performance troubleshooting plan for Office 365](https://support.office.com/article/Performance-troubleshooting-plan-for-Office-365-e241e5d9-b1d8-4f1d-a5c8-4106b7325f8c) .</span></span>
  
<span data-ttu-id="014e8-541">Ecco un collegamento breve per tornare alla pagina: [https://aka.ms/implementexpressroute365](https://aka.ms/implementexpressroute365)</span><span class="sxs-lookup"><span data-stu-id="014e8-541">Here's a short link you can use to come back: [https://aka.ms/implementexpressroute365](https://aka.ms/implementexpressroute365)</span></span>
  
## <a name="related-topics"></a><span data-ttu-id="014e8-542">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="014e8-542">Related Topics</span></span>

[<span data-ttu-id="014e8-543">Valutazione della connettività di rete di Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-543">Assessing Office 365 network connectivity</span></span>](assessing-network-connectivity.md)
  
[<span data-ttu-id="014e8-544">Azure ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-544">Azure ExpressRoute for Office 365</span></span>](azure-expressroute.md)
  
[<span data-ttu-id="014e8-545">Gestione di ExpressRoute per la connettività di Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-545">Managing ExpressRoute for Office 365 connectivity</span></span>](managing-expressroute-for-connectivity.md)
  
[<span data-ttu-id="014e8-546">Routing con ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-546">Routing with ExpressRoute for Office 365</span></span>](routing-with-expressroute.md)
  
[<span data-ttu-id="014e8-547">Pianificazione della rete con ExpressRoute per Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-547">Network planning with ExpressRoute for Office 365</span></span>](network-planning-with-expressroute.md)
  
[<span data-ttu-id="014e8-548">Utilizzo delle community BGP in ExpressRoute per gli scenari di Office 365 (anteprima)</span><span class="sxs-lookup"><span data-stu-id="014e8-548">Using BGP communities in ExpressRoute for Office 365 scenarios (preview)</span></span>](bgp-communities-in-expressroute.md)
  
[<span data-ttu-id="014e8-549">Qualità multimediale e prestazioni della connettività di rete in Skype for Business Online</span><span class="sxs-lookup"><span data-stu-id="014e8-549">Media Quality and Network Connectivity Performance in Skype for Business Online</span></span>](https://support.office.com/article/5fe3e01b-34cf-44e0-b897-b0b2a83f0917)
  
[<span data-ttu-id="014e8-550">Ottimizzazione della rete per Skype for Business Online</span><span class="sxs-lookup"><span data-stu-id="014e8-550">Optimizing your network for Skype for Business Online</span></span>](https://support.office.com/article/b363bdca-b00d-4150-96c3-ec7eab5a8a43)
  
[<span data-ttu-id="014e8-551">ExpressRoute e QoS in Skype for business online</span><span class="sxs-lookup"><span data-stu-id="014e8-551">ExpressRoute and QoS in Skype for Business Online</span></span>](https://support.office.com/article/20c654da-30ee-4e4f-a764-8b7d8844431d)
  
[<span data-ttu-id="014e8-552">Flusso delle chiamate con ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="014e8-552">Call flow using ExpressRoute</span></span>](https://support.office.com/article/413acb29-ad83-4393-9402-51d88e7561ab)
  
[<span data-ttu-id="014e8-553">Ottimizzazione delle prestazioni di Office 365 mediante l'uso della cronologia delle prestazioni e delle previsioni</span><span class="sxs-lookup"><span data-stu-id="014e8-553">Office 365 performance tuning using baselines and performance history</span></span>](performance-tuning-using-baselines-and-history.md)
  
[<span data-ttu-id="014e8-554">Piano di risoluzione dei problemi di prestazioni per Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-554">Performance troubleshooting plan for Office 365</span></span>](performance-troubleshooting-plan.md)
  
[<span data-ttu-id="014e8-555">URL e intervalli di indirizzi IP per Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-555">Office 365 URLs and IP address ranges</span></span>](https://support.office.com/article/8548a211-3fe7-47cb-abb1-355ea5aa88a2)
  
[<span data-ttu-id="014e8-556">Ottimizzazione delle prestazioni e della rete di Office 365</span><span class="sxs-lookup"><span data-stu-id="014e8-556">Office 365 network and performance tuning</span></span>](network-planning-and-performance.md)
